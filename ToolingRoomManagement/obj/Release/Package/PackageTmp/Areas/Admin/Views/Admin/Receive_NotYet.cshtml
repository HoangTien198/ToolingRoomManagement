
@{
    ViewBag.Title = "Receive_NotYet";
    Layout = "~/Areas/Admin/Views/Shared/_Layout_AdminPage.cshtml";
    var session = (ToolingRoomManagement.Common.UserLogin)Session[ToolingRoomManagement.Common.CommonConstants.USER_SESSION];
    var listManager = (List<Model.EF.User>)ViewBag.listManager;
    int dem = 0;
    var date = DateTime.Now.ToString("yyyy-MM-dd");
}

<script src="~/Assets/admin/js/vendor/jquery-1.12.4.min.js"></script>
<style>
    .animation {
        background-color: red;
        position: relative;
        animation-name: example;
        animation-duration: 4s;
        animation-iteration-count: infinite;
    }

    .tblShow {
        border: 1px solid;
    }

        .tblShow thead tr th {
            vertical-align: middle;
            background: #2d9aca;
            /*padding: 0px 0px 0px 15px;*/
            text-align: center;
        }

        .tblShow tbody tr td {
            vertical-align: middle;
            padding: 6px 15px;
        }

    ::-webkit-scrollbar {
        width: 9px;
        height: 5px;
    }

    ::-webkit-scrollbar-thumb {
        -webkit-box-shadow: inset 0 0 4px 9px rgba(0,0,0,0.3);
        border-radius: 10px;
    }

    #tbl_Receive thead tr th {
        /*word-break: break-all;*/
        background: #5c7096;
        position: sticky;
        top: -3px;
        font-size: 1.7vh;
        text-align:center;
    }

    #tbdReceive tr td {
        vertical-align: middle;
        padding: 6px 5px;
        /*word-break: break-all;*/
        font-size: 1.5vh;
        text-align:center;
    }

    #tbdReceive tr:hover {
        background: #0606066e;
    }
</style>
<div>
    <div class="header-advance-area">

        <!-- Mobile Menu start -->
        <div class="mobile-menu-area">
            <div class="container">

            </div>
        </div>
        <!-- Mobile Menu end -->
        <div class="breadcome-area" style="margin-top: 40px;">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="breadcome-list" style="padding: 10px 20px 10px 20px;margin: 30px 0px 10px 0px;">
                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                    <div class="breadcomb-wp">
                                        <div class="breadcomb-icon zoom" data-toggle="tooltip" data-placement="bottom" title="Home">
                                            @if (session.GroupID == 1)
                                            {
                                                <a href="/Admin/Admin/Index"><i class="icon nalika-home"></i></a>
                                            }
                                            else if (session.GroupID == 2)
                                            {
                                                <a href="/Admin/Admin/UserPage"><i class="icon nalika-home"></i></a>
                                            }
                                            else if (session.GroupID == 3)
                                            {
                                                <a href="/Admin/Admin/StaffPage"><i class="icon nalika-home"></i></a>
                                            }
                                            else if (session.GroupID == 4)
                                            {
                                                <a href="/Admin/Admin/Confirm_Page"><i class="icon nalika-home"></i></a>
                                            }
                                        </div>
                                        <div class="breadcomb-ctn">
                                            <h2 langKey="">All Receive</h2>
                                            <p>Welcome to Tooling <span class="bread-ntd">Room</span></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                    <div class="breadcomb-report">
                                        <button data-toggle="tooltip" data-placement="left" title="Export To Excel" class="btn" onclick="fnExcelReport()"><i class="icon nalika-download"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="product-sales-area mg-tb-30" style="margin: 10px 0px;">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="height:90vh;">
                    <div class="product-sales-chart" style="padding: 5px 10px 5px 20px;">
                        <div class="portlet-title">
                            <div class="row">
                                <div>
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="float:right;margin-right:25px;">
                                        <div class="header-top-menu tabl-d-n hd-search-rp">
                                            <div class="breadcome-heading" style="margin: 0px 0px 10px 0px;">
                                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8" style="color: wheat;margin-left:10px;">
                                                    <h4>Lưu trình: </h4>
                                                    <p onclick="show_table('tbl_Receive')">Lĩnh đồ: Quản lý -> C.Thản -> (Quản lý) -> Thủy</p>
                                                    <p onclick="show_back()">Trả đồ: Quản lý -> Thủy xác nhận -> C.Thản -> (Quản lý) -> Thủy</p>
                                                </div>
                                                <form role="search" class="col-lg-2 col-md-2 col-sm-2 col-xs-2" style="float: right;">
                                                    <input id="input_search" type="text" placeholder="Search..." class="form-control" style="width: 100%;color: #fffaf0;height: 39px;">
                                                    <a href="" style="left: 72%;margin-top: -8px;float: right;"><i class="fa fa-search"></i></a>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="width:100%;float:left;height: 80vh;">
                                    <div style="padding: 5px 26px 5px 10px;overflow:auto;">
                                        <div style="overflow:auto;height: 80vh;">
                                            @*<h3 style="color:aliceblue;">Not Yet Complete! ~_~</h3>*@
                                            <table id="tbl_Receive" class="tblShow table-bordered" style="width: 100%; color:white;">
                                                <thead>
                                                    <tr style="height: 7vh;">
                                                        <th style="width: 3%;">#</th>
                                                        <th style="width: 5%;" langkey="">Code</th>
                                                        <th style="width: 5%;" langkey="">Receive Name</th>
                                                        <th style="width: 5%;" langkey="">Status</th>
                                                        <th style="width: 5%;">Note</th>
                                                        <th langkey="" style="width: 5%;">Creater</th>
                                                        <th langkey="date" style="width: 6%;" placeholder="Date">Date</th>
                                                        <th langkey="" style="width: 10%;" colspan="2">Manager</th>
                                                        <th langkey="" style="width: 5%;">Note Manager</th>

                                                        <th langkey="" colspan="2" style="width: 12%;">C.Than</th>
                                                        <th langkey="" style="width: 5%;">Note C.Than</th>
                                                        <th langkey="" style="width: 10%;" colspan="2">Transfer</th>
                                                        <th langkey="" colspan="2" style="width: 10%;">Thuy</th>
                                                        <th langkey="" style="width: 7%;">Note Thuy</th>
                                                        <th style="width: 5%;">Date Complete</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tbdReceive"></tbody>
                                            </table>
                                            <table id="tbl_Receive1" class="tblShow table-bordered" style="width: 100%; color:white;">
                                                <thead>
                                                    <tr style="height: 7vh;">
                                                        <th style="width: 3%;">#</th>
                                                        <th style="width: 5%;" langkey="">Code</th>
                                                        <th style="width: 5%;" langkey="">Receive Name</th>
                                                        <th style="width: 5%;" langkey="">Code Device</th>
                                                        <th style="width: 5%;" langkey="">SN</th>
                                                        <th style="width: 5%;" langkey="">Status</th>
                                                        <th style="width: 5%;">Note</th>
                                                        <th langkey="" style="width: 5%;">Creater</th>
                                                        <th langkey="date" style="width: 6%;" placeholder="Date">Date</th>
                                                        <th langkey="" style="width: 10%;" colspan="2">Manager</th>
                                                        <th langkey="" style="width: 5%;">Note Manager</th>
                                                        <th langkey="" colspan="2" style="width: 12%;">C.Than</th>
                                                        <th langkey="" style="width: 5%;">Note C.Than</th>
                                                        <th langkey="" style="width: 10%;" colspan="2">Transfer</th>
                                                        <th langkey="" colspan="2" style="width: 10%;">Thuy</th>
                                                        <th langkey="" style="width: 7%;">Note Thuy</th>
                                                        <th style="width: 5%;">Date Complete</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tbdReceive1"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="myModal">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Detail Order</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <input hidden id="receive_id" />
                <table class="table table-dark tblCreate">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Device Name</th>
                            <th>Location</th>
                            <th>Quantity</th>
                            <th>Type</th>
                            <th>Note</th>
                        </tr>
                    </thead>
                    <tbody id="tblReceive" style="text-align:center;"></tbody>
                </table>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer" id="footer_modal">
                <button type="button" class="btn btn-secondary btnclose">Close</button>
                <button type="button" style="background: green;color: white;" class="btn btn-secondary" onclick="confirm()">Confirm</button>
                <button type="button" style="background: red;color: white;" class="btn btn-secondary btnreject" onclick="open_reject()">Reject</button>
                <select id="manager_add" style="border-radius: 5px;border: 1px solid #c5b4b4;width: 135px;height: 34px;">
                    <option value="0">Choose Manager</option>
                    @foreach (var item in listManager)
                    {
                        <option value="@item.id">@item.fullname</option>
                    }
                </select>
                <button type="button" class="btn btn-secondary" onclick="Add_Manager_Confirm()" style="background:#5150a0;color: white;">Transfer</button>
            </div>

        </div>
    </div>
</div>
<div class="modal" id="myModal_OK">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Detail Order</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <input hidden id="receive_id" />
                <table class="table table-dark tblCreate">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Device Name</th>
                            <th>Location</th>
                            <th>Quantity</th>
                            <th>Type</th>
                            <th>Note</th>
                        </tr>
                    </thead>
                    <tbody id="tblReceive_OK" style="text-align:center;"></tbody>
                </table>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btnclose">Close</button>
            </div>

        </div>
    </div>
</div>
<div class="modal" id="myModal_Reject" style="z-index:10000;">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Reject Note</h4>
                <button type="button" class="close_reject" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <input hidden id="id_receive" />
                <textarea class="form-control" id="note_receive" style="color: #000;border-radius: 11px; margin-left: 100px;width: 80%;background: aliceblue; height: 80px;border: 1px solid #d4abab;"></textarea>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" style="background: red;color: white;" class="btn btn-secondary btnreject" onclick="reject()">Submit</button>
            </div>

        </div>
    </div>
</div>
<div class="modal" id="ModalDeviceBackRoom">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Chi tiết</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>

            </div>

            <!-- Modal body -->
            <div class="modal-body" style="height: 60vh;overflow: auto;">
                <input hidden id="receive_id" />

                <table class="" style="border:0;margin-left: 60px;" id="tblBack">
                    <tr>
                        <td style="width: 150px;height: 50px;">Mã Kiểm kê: </td>
                        <td class="makiemke"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;">Mã SN: </td>
                        <td class="maSN"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;">Tên TB: </td>
                        <td class="tenTB"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;">Model: </td>
                        <td class="model_TB"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;">Mã Hiệu chuẩn: </td>
                        <td class="mahieuchuan"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;">Nhập vào kho : </td>
                        <td class="kho_TB"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;">Tình trạng TB: </td>
                        <td class="statusTB"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;">Ghi chú: </td>
                        <td class="noteTB"></td>
                    </tr>
                    <tr class="image_TB">
                        <td style="width: 150px;height: 50px;">Hình ảnh: </td>
                        <td class="imageTB">
                            @*<input type="file" class="form-control TYPEDEVICE" style="background-color:white;color:black;border: 1px solid #5c7096;border-radius: 21px;" id="imageTB" multiple>*@

                        </td>
                    </tr>


                </table>

            </div>

            <!-- Modal footer -->
            <div class="modal-footer" id="footer_modal_Back">
                <button type="button" class="btn btn-secondary btnclose">Close</button>
                <button type="button" class="btn btn-secondary" onclick="confirm()" style="background: green;color: white;">Confirm</button>
                <button type="button" class="btn btn-secondary" onclick="open_reject()" style="background: red;color: white;">Reject</button>
                <select id="manager_add1" style="border-radius: 5px;border: 1px solid #c5b4b4;width: 135px;height: 34px;">

                    @foreach (var item in listManager)
                    {
                        <option value="@item.id">@item.fullname</option>
                    }
                </select>
                <button type="button" class="btn btn-secondary" onclick="Add_Manager_Confirm1()" style="background:#5150a0;color: white;">Transfer</button>

            </div>

        </div>
    </div>
</div>

<script>
    var tab = "tbl";

    function show_table(id_table) {
        var i;
        var x = document.getElementsByClassName("tblShow");
        for (i = 0; i < x.length; i++) {
            x[i].style.display = "none";
        }
        document.getElementById(id_table).style.display = "block";
        tab = id_table;
    }
    var modal = document.getElementById("myModal");
    var modal_OK = document.getElementById("myModal_OK");
    var modal_reject = document.getElementById("myModal_Reject");
    var modalDeviceBackRoom = document.getElementById("ModalDeviceBackRoom");
    $(document).on("click", ".close", function () {
        modal.style.display = "none";
        modal_OK.style.display = "none";
        modalDeviceBackRoom.style.display = "none";
    })
    $(document).on("click", ".close_reject", function () {
        modal_reject.style.display = "none";
    })
    $(document).on("click", ".btnclose", function () {
        modal.style.display = "none";
        modal_OK.style.display = "none";
        modalDeviceBackRoom.style.display = "none";
    })
    document.getElementById("tbl_Receive").style.display = "block";
    document.getElementById("tbl_Receive1").style.display = "none";
    $("#tbdReceive").empty();
    $("#tbdReceive1").empty();
    $.ajax({
        type: "POST",
        url: "/Receive/get_ReceiveGet",
        //data:data,
        contentType: "application/json",
        datatype: "json/text",
        success: function (data) {
            var row = "";
            var row1 = "";
            if (JSON.parse(data).length > 0) {
                for (i = 0; i < JSON.parse(data).length; i++) {
                    var status = "";
                    if (JSON.parse(data)[i].status == 1 || JSON.parse(data)[i].status == 2 || JSON.parse(data)[i].status == 6 || JSON.parse(data)[i].status == 7) {
                        status = '<a style="color:orange;">Wait<a>';
                    } else if (JSON.parse(data)[i].status == 3) {
                        status = '<a style="color:red;">Reject<a>';
                    } else if (JSON.parse(data)[i].status == 4) {
                        status = '<a style="color:green;">OK<a>';
                    } else if (JSON.parse(data)[i].status == 5) {
                        status = '<a style="color:yellow;">Not Yet<a>';
                    }
                    var detail = "'" + JSON.parse(data)[i].id + "','" + JSON.parse(data)[i].code_receive.substring(0, 1) + "','" + JSON.parse(data)[i].status + "'";
                    if (JSON.parse(data)[i].code_receive.substring(0, 1) == "R") {
                        row += '<tr style="height: 20vh;" onclick="detail_Receive(' + detail + ')">' +
                            '<td>' + (i + 1) + '</td>' +
                            '<td>' + JSON.parse(data)[i].code_receive + '</td>' +
                            '<td>' + JSON.parse(data)[i].receive_name + '</td>' +
                            '<td>' + status + '</td>' +
                            '<td>' + (JSON.parse(data)[i].note != null ? JSON.parse(data)[i].note : "") + '</td>' +
                            '<td>' + JSON.parse(data)[i].create_by + '</td>' +
                            '<td>' + (JSON.parse(data)[i].create_date != null ? convert_date(JSON.parse(data)[i].create_date) : "") + '</td>' +
                            '<td style="width: 5%;">' + JSON.parse(data)[i].manager_confirm + '</td>' +
                            '<td>' + (JSON.parse(data)[i].time_manager_cf != null ? convert_date(JSON.parse(data)[i].time_manager_cf) : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].note_manager != null ? JSON.parse(data)[i].note_manager : "") + '</td>' +

                            '<td style="width: 5%;">C.Than</td>' +
                            '<td>' + (JSON.parse(data)[i].time_CThanConfirm != null ? convert_date(JSON.parse(data)[i].time_CThanConfirm) : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].note_cThan != null ? JSON.parse(data)[i].note_cThan : "") + '</td>' +
                            '<td style="width:5%;">' + (JSON.parse(data)[i].add_manager_name != null ? JSON.parse(data)[i].add_manager_name : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].time_transfer_cf != null ? convert_date(JSON.parse(data)[i].time_transfer_cf) : "") + '</td>' +
                            '<td style="width: 5%;">Thuy</td>' +
                            '<td>' + (JSON.parse(data)[i].time_Thuy_cf != null ? convert_date(JSON.parse(data)[i].time_Thuy_cf) : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].note_Thuy != null ? JSON.parse(data)[i].note_Thuy : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].complete_date != null ? convert_date(JSON.parse(data)[i].complete_date) : "") + '</td>' +
                            +'</tr>';
                    }
                }
            } else {
                row = '<tr>' +
                    '<td colspan="13" style="text-align:center;color:black;">-----No Data-----</td>' +
                    '</tr>';
                row1 = '<tr>' +
                    '<td colspan="13" style="text-align:center;color:black;">-----No Data-----</td>' +
                    '</tr>';
            }
            $("#tbdReceive").empty();
            $("#tbdReceive").append(row);
            tab = "tbl_Receive";

            //show_table("tbdReceive");
            //$("#tbdReceive1").append(row1);
        },
        error: function (returnval) {
        }
    });
    function show_back() {
        $.ajax({
            type: "POST",
            url: "/Receive/get_ReceiveBack",
            //data:data,
            contentType: "application/json",
            datatype: "json/text",
            success: function (data) {
                var row = "";
                var row1 = "";
                if (JSON.parse(data)[0].length > 0) {
                    for (i = 0; i < JSON.parse(data)[0].length; i++) {
                        var status = "";
                        if (JSON.parse(data)[0][i].receive.status == 1 || JSON.parse(data)[0][i].receive.status == 2 || JSON.parse(data)[0][i].receive.status == 6 || JSON.parse(data)[0][i].receive.status == 7) {
                            status = '<a style="color:orange;">Wait<a>';
                        } else if (JSON.parse(data)[0][i].receive.status == 3) {
                            status = '<a style="color:red;">Reject<a>';
                        } else if (JSON.parse(data)[0][i].receive.status == 4) {
                            status = '<a style="color:green;">OK<a>';
                        } else if (JSON.parse(data)[0][i].receive.status == 5) {
                            status = '<a style="color:yellow;">Not Yet<a>';
                        }
                        var detail = "'" + JSON.parse(data)[0][i].receive.id + "','" + JSON.parse(data)[0][i].receive.code_receive.substring(0, 1) + "','" + JSON.parse(data)[0][i].receive.status + "'";
                        if (JSON.parse(data)[0][i].receive.code_receive.substring(0, 1) == "I") {
                            row1 += '<tr style="height: 20vh;" onclick="detail_Receive(' + detail + ')">' +
                                '<td>' + (i + 1) + '</td>' +
                                '<td>' + JSON.parse(data)[0][i].receive.code_receive + '</td>' +
                                '<td>' + JSON.parse(data)[0][i].receive.receive_name + '</td>' +
                                '<td>' + JSON.parse(data)[0][i].code_device + '</td>' +
                                '<td>' + JSON.parse(data)[0][i].SN_device + '</td>' +
                                '<td>' + status + '</td>' +
                                '<td>' + (JSON.parse(data)[0][i].receive.note != null ? JSON.parse(data)[0][i].receive.note : "") + '</td>' +
                                '<td>' + JSON.parse(data)[0][i].receive.create_by + '</td>' +
                                '<td>' + (JSON.parse(data)[0][i].receive.create_date != null ? convert_date(JSON.parse(data)[0][i].receive.create_date) : "") + '</td>' +
                                '<td style="width: 5%;">' + JSON.parse(data)[0][i].receive.manager_confirm + '</td>' +
                                '<td>' + (JSON.parse(data)[0][i].receive.time_manager_cf != null ? convert_date(JSON.parse(data)[0][i].receive.time_manager_cf) : "") + '</td>' +
                                '<td>' + (JSON.parse(data)[0][i].receive.note_manager != null ? JSON.parse(data)[0][i].receive.note_manager : "") + '</td>' +

                                '<td style="width: 5%;">C.Than</td>' +
                                '<td>' + (JSON.parse(data)[0][i].receive.time_CThanConfirm != null ? convert_date(JSON.parse(data)[0][i].receive.time_CThanConfirm) : "") + '</td>' +
                                '<td>' + (JSON.parse(data)[0][i].receive.note_cThan != null ? JSON.parse(data)[0][i].receive.note_cThan : "") + '</td>' +
                                '<td style="width:5%;">' + (JSON.parse(data)[0][i].receive.add_manager_name != null ? JSON.parse(data)[0][i].receive.add_manager_name : "") + '</td>' +
                                '<td>' + (JSON.parse(data)[0][i].receive.time_transfer_cf != null ? convert_date(JSON.parse(data)[0][i].receive.time_transfer_cf) : "") + '</td>' +
                                '<td style="width: 5%;">Thuy</td>' +
                                '<td>' + (JSON.parse(data)[0][i].receive.time_Thuy_cf != null ? convert_date(JSON.parse(data)[0][i].receive.time_Thuy_cf) : "") + '</td>' +
                                '<td>' + (JSON.parse(data)[0][i].receive.note_Thuy != null ? JSON.parse(data)[0][i].receive.note_Thuy : "") + '</td>' +
                                '<td>' + (JSON.parse(data)[0][i].receive.complete_date != null ? convert_date(JSON.parse(data)[0][i].receive.complete_date) : "") + '</td>' +
                                +'</tr>';
                        }

                    }
                } else {
                    row1 = '<tr>' +
                        '<td colspan="13" style="text-align:center;color:black;">-----No Data-----</td>' +
                        '</tr>';
                }
                if (JSON.parse(data)[1].length > 0) {
                    for (i = 0; i < JSON.parse(data)[1].length; i++) {
                        var status = "";
                        if (JSON.parse(data)[1][i].receive.status == 1 || JSON.parse(data)[1][i].receive.status == 2 || JSON.parse(data)[1][i].receive.status == 6 || JSON.parse(data)[1][i].receive.status == 7) {
                            status = '<a style="color:orange;">Wait<a>';
                        } else if (JSON.parse(data)[1][i].receive.status == 3) {
                            status = '<a style="color:red;">Reject<a>';
                        } else if (JSON.parse(data)[1][i].receive.status == 4) {
                            status = '<a style="color:green;">OK<a>';
                        } else if (JSON.parse(data)[1][i].receive.status == 5) {
                            status = '<a style="color:yellow;">Not Yet<a>';
                        }
                        var detail = "'" + JSON.parse(data)[1][i].receive.id + "','" + JSON.parse(data)[1][i].receive.code_receive.substring(0, 1) + "','" + JSON.parse(data)[1][i].receive.status + "'";
                        if (JSON.parse(data)[1][i].receive.code_receive.substring(0, 1) == "I") {
                            row1 += '<tr style="height: 20vh;" onclick="detail_Receive(' + detail + ')">' +
                                '<td>' + (i + 1) + '</td>' +
                                '<td>' + JSON.parse(data)[1][i].receive.code_receive + '</td>' +
                                '<td>' + JSON.parse(data)[1][i].receive.receive_name + '</td>' +
                                '<td>' + '</td>' +
                                '<td>' + JSON.parse(data)[1][i].deviceback.produce_SN + '</td>' +
                                '<td>' + status + '</td>' +
                                '<td>' + (JSON.parse(data)[1][i].receive.note != null ? JSON.parse(data)[1][i].receive.note : "") + '</td>' +
                                '<td>' + JSON.parse(data)[1][i].receive.create_by + '</td>' +
                                '<td>' + (JSON.parse(data)[1][i].receive.create_date != null ? convert_date(JSON.parse(data)[1][i].receive.create_date) : "") + '</td>' +
                                '<td style="width: 5%;">' + JSON.parse(data)[1][i].receive.manager_confirm + '</td>' +
                                '<td>' + (JSON.parse(data)[1][i].receive.time_manager_cf != null ? convert_date(JSON.parse(data)[1][i].receive.time_manager_cf) : "") + '</td>' +
                                '<td>' + (JSON.parse(data)[1][i].receive.note_manager != null ? JSON.parse(data)[1][i].receive.note_manager : "") + '</td>' +

                                '<td style="width: 5%;">C.Than</td>' +
                                '<td>' + (JSON.parse(data)[1][i].receive.time_CThanConfirm != null ? convert_date(JSON.parse(data)[1][i].receive.time_CThanConfirm) : "") + '</td>' +
                                '<td>' + (JSON.parse(data)[1][i].receive.note_cThan != null ? JSON.parse(data)[1][i].receive.note_cThan : "") + '</td>' +
                                '<td style="width:5%;">' + (JSON.parse(data)[1][i].receive.add_manager_name != null ? JSON.parse(data)[1][i].receive.add_manager_name : "") + '</td>' +
                                '<td>' + (JSON.parse(data)[1][i].receive.time_transfer_cf != null ? convert_date(JSON.parse(data)[1][i].receive.time_transfer_cf) : "") + '</td>' +
                                '<td style="width: 5%;">Thuy</td>' +
                                '<td>' + (JSON.parse(data)[1][i].receive.time_Thuy_cf != null ? convert_date(JSON.parse(data)[1][i].receive.time_Thuy_cf) : "") + '</td>' +
                                '<td>' + (JSON.parse(data)[1][i].receive.note_Thuy != null ? JSON.parse(data)[1][i].receive.note_Thuy : "") + '</td>' +
                                '<td>' + (JSON.parse(data)[1][i].receive.complete_date != null ? convert_date(JSON.parse(data)[1][i].receive.complete_date) : "") + '</td>' +
                                +'</tr>';
                        }

                    }
                } else {
                    row = '<tr>' +
                        '<td colspan="13" style="text-align:center;color:black;">-----No Data-----</td>' +
                        '</tr>';
                }
                $("#tbdReceive1").empty();
                $("#tbdReceive1").append(row1 + row);
                document.getElementById("tbl_Receive").style.display = "none";
                document.getElementById("tbl_Receive1").style.display = "block";
                tab = "tbl_Receive1";
                //show_table("tbdReceive1");
            },
            error: function (returnval) {
            }
        });
    }
    function detail_Receive(receive_id, code_receive, status) {
        $(".imageTB").empty();

        if (code_receive == "R") {
            $("#tblReceive").empty();
            var footer = "";
            if (parseInt(status) == 4) {
                $("#footer_modal").empty();
                var footer = '<button type="button" class="btn btn-secondary btnclose">Close</button>';
                $("#footer_modal").append(footer);
                $.ajax({
                    type: "Post",
                    url: "/Receive/get_Output_Receive?receive_id=" + receive_id,
                    async: false,
                    contentType: false,
                    processData: false,
                    success: function (data) {
                        //alert(data);
                        //debugger
                        var length = JSON.parse(data).length;
                        var row = "";
                        //if (length == 0) {
                        //    alert("Dont have any device!");
                        //    return;
                        //}
                        for (i = 0; i < length; i++) {
                            var type = "";
                            if (JSON.parse(data)[i].output.type == 1) {
                                type = "Get";
                            } else if (JSON.parse(data)[i].output.type == 2) {
                                type = "Change";
                            } else {
                                type = "Borrow";
                            }
                            var note = "";
                            if (JSON.parse(data)[i].output.note != null) {
                                note = JSON.parse(data)[i].output.note;
                            }
                            else {
                                note = "";
                            }
                            row = row + '<tr>' +
                                '<td>' + (i + 1) + '</td>' +
                                '<td>' + JSON.parse(data)[i].device_name + '</td>' +
                                '<td>' + JSON.parse(data)[i].location + '</td>' +
                                '<td class="quantity">' + JSON.parse(data)[i].output.quantity_output + '</td>' +
                                '<td>' + type + '</td>' +
                                '<td>' + note + '</td>' +
                                '</tr>';
                        }
                        $("#tblReceive_OK").empty();
                        $("#receive_id").val(receive_id);
                        $("#tblReceive_OK").append(row);
                        modal_OK.style.display = "block";
                    },
                    error: function (err) {
                        //debugger
                        alert("FAIL!");
                    }
                });
            } else {
                $("#tblReceive").empty();
                $.ajax({
                    type: "Post",
                    url: "/Receive/get_ClipOutput_Receive?receive_id=" + receive_id,
                    async: false,
                    contentType: false,
                    processData: false,
                    success: function (data) {
                        //alert(data);
                        //debugger
                        var length = JSON.parse(data).length;
                        var row = "";
                        //if (length == 0) {
                        //    alert("Dont have any device!");
                        //    return;
                        //}
                        for (i = 0; i < length; i++) {
                            var type = "";
                            if (JSON.parse(data)[i].clipOutput.type == 1) {
                                type = "Receive";
                            } else if (JSON.parse(data)[i].clipOutput.type == 2) {
                                type = "Change";
                            } else {
                                type = "Borrow";
                            }
                            var note = "";
                            if (JSON.parse(data)[i].clipOutput.note != null) {
                                note = JSON.parse(data)[i].clipOutput.note;
                            }
                            else {
                                note = "";
                            }
                            var confirm = "'" + JSON.parse(data)[i].clipOutput.quantity + "','" + JSON.parse(data)[i].clipOutput.device_id + "','" + JSON.parse(data)[i].clipOutput.receive_id + "','" + JSON.parse(data)[i].clipOutput.id + "','" + JSON.parse(data)[i].clipOutput.type + "','" + note + "'";
                            row = row + '<tr>' +
                                '<td>' + (i + 1) + '</td>' +
                                '<td>' + JSON.parse(data)[i].device_name + '</td>' +
                                '<td>' + JSON.parse(data)[i].location + '</td>' +
                                '<td class="quantity">' + JSON.parse(data)[i].clipOutput.quantity + '</td>' +
                                '<td>' + type + '</td>' +
                                '<td>' + note + '</td>' +
                                '</tr>';
                        }
                        $("#receive_id").val(receive_id);
                        $("#tblReceive").append(row);
                        modal.style.display = "block";
                    },
                    error: function (err) {
                        //debugger
                        alert("FAIL!");
                    }
                });
            }
        } else if (code_receive == "I") {
            $("#footer_modal_Back").empty();
            var footer = '<button type="button" class="btn btn-secondary btnclose">Close</button>';
            $("#footer_modal_Back").append(footer);

            $(".makiemke").empty();
            $(".maSN").empty();
            $(".tenTB").empty();
            $(".model_TB").empty();
            $("#receive_id").empty();
            $(".mahieuchuan").empty();
            $(".kho_TB").empty();
            $(".statusTB").empty();
            $(".noteTB").empty();
            $(".imageTB").empty();
            if (parseInt(status) == 4) {
                $(".makiemke").empty();
                $(".maSN").empty();
                $(".tenTB").empty();
                $(".model_TB").empty();
                $("#receive_id").empty();
                $(".mahieuchuan").empty();
                $(".kho_TB").empty();
                $(".statusTB").empty();
                $(".noteTB").empty();
                $(".imageTB").empty();
                $.ajax({
                    type: "Post",
                    url: "/Receive/get_Device_Back?receive_id=" + receive_id,
                    async: false,
                    contentType: false,
                    processData: false,
                    success: function (data) {
                        //alert(data);
                        debugger
                        var row = "";
                        $(".makiemke").append("<div>" + JSON.parse(data)[0].device.makiemke + "</div>");
                        $(".maSN").append("<div>" + JSON.parse(data)[0].device.produce_SN + "</div>");
                        $(".tenTB").append("<div>" + JSON.parse(data)[0].device.device_name + "</div>");
                        $(".model_TB").append("<div>" + JSON.parse(data)[0].device.parameter + "</div>");
                        var a = "";
                        if (JSON.parse(data)[0].device.calibration != null) {
                            a = JSON.parse(data)[0].device.calibration;
                        } else {
                            a = "N/A";
                        }
                        $(".mahieuchuan").append("<div>" + a + "</div>");
                        $(".kho_TB").append("<div>" + JSON.parse(data)[0].device.location + "</div>");
                        if (JSON.parse(data)[0].device.status == 1) {
                            $(".statusTB").append("<div>OK</div>");
                        } else {
                            $(".statusTB").append("<div>NG</div>");
                        }
                        $(".noteTB").append(JSON.parse(data)[0].device.note_status);
                        if (JSON.parse(data)[0].device.imageTB != null) {
                            $(".imageTB").append("<div>Không có hình ảnh nào!</div>");
                        } else {
                            debugger
                            var image_ = JSON.parse(JSON.parse(data)[0].device.image_TB);
                            var list_image = "";
                            for (j = 0; j < image_.length; j++) {
                                list_image += '<a href="/Data/Image/' + image_[j].file + '" data-toggle="lightbox" data-max-width="600" >' +
                                    '   <img style="width:150px;height:100px;border: 1px solid #2c303a" src="/Data/Image/' + image_[j].file + '" class="img-fluid">' +
                                    '</a>';
                            }
                            $(".imageTB").append(list_image);
                        }
                        modalDeviceBackRoom.style.display = "block";
                    },
                    error: function (err) {
                        //debugger
                        alert("FAIL!");
                    }
                });
            } else {
                $.ajax({
                    type: "Post",
                    url: "/Device/get_DeviceBackRoom?receive_id=" + receive_id,
                    async: false,
                    contentType: false,
                    processData: false,
                    success: function (data) {
                        //alert(data);
                        //debugger
                        var row = "";
                        $(".makiemke").append("<div>" + (JSON.parse(data).makiemke != "NULL" ? JSON.parse(data).makiemke : "") + "</div>");
                        $(".maSN").append("<div  id='SN_TB'>" + JSON.parse(data).produce_SN + "</div>");
                        $(".tenTB").append("<div>" + JSON.parse(data).device_name + "</div>");
                        $(".model_TB").append("<div>" + JSON.parse(data).parameter + "</div>");
                        $("#receive_id").val(JSON.parse(data).receive_id);
                        var a = "";
                        if (JSON.parse(data).calibration != null) {
                            a = JSON.parse(data).calibration;
                        } else {
                            a = "N/A";
                        }
                        $(".mahieuchuan").append("<div>" + a + "</div>");
                        $(".kho_TB").append("<div>" + JSON.parse(data).location + "</div>");
                        if (JSON.parse(data).status == 1) {
                            $(".statusTB").append("<div>OK</div>");
                        } else {
                            $(".statusTB").append("<div>NG</div>");
                        }
                        $(".noteTB").append(JSON.parse(data).note_status);
                        if (JSON.parse(data).imageTB != null) {
                            $(".imageTB").append("<div>Không có hình ảnh nào!</div>");
                        } else {
                            debugger
                            var image_ = JSON.parse(JSON.parse(data).image_TB);
                            var list_image = "";
                            for (j = 0; j < image_.length; j++) {
                                list_image += '<a href="/Data/Image/' + image_[j].file + '" data-toggle="lightbox" data-max-width="600" >' +
                                    '   <img style="width:150px;height:100px;border: 1px solid #2c303a" src="/Data/Image/' + image_[j].file + '" class="img-fluid">' +
                                    '</a>';
                            }
                            $(".imageTB").append(list_image);
                        }
                        modalDeviceBackRoom.style.display = "block";
                    },
                    error: function (err) {
                        //debugger
                        alert("FAIL!");
                    }
                });
            }

        }
    }
    function confirm() {
        var id = document.getElementById("receive_id").value;
        $.ajax({
            type: "Post",
            url: "/Receive/CThan_Confirm?id=" + id,
            async: false,
            contentType: false,
            processData: false,
            success: function (data) {
                alert("OK");
                modal.style.display = "none";
                location.reload();
            },
            error: function (err) {
                //debugger
                alert("FAIL!");
            }
        });
    }
    function confirm_Back() {
        var id = document.getElementById("receive_id").value;
        $.ajax({
            type: "Post",
            url: "/Receive/CThan_Confirm_Back?id=" + id,
            async: false,
            contentType: false,
            processData: false,
            success: function (data) {
                alert("OK");
                modal.style.display = "none";
                location.reload();
            },
            error: function (err) {
                //debugger
                alert("FAIL!");
            }
        });
    }
    function open_reject() {
        var id = document.getElementById("receive_id").value;
        $("#id_receive").val(id);
        modal_reject.style.display = "block";
    }
    function reject() {
        var id = document.getElementById("id_receive").value;
        if ($("#note_receive").val() != "") {
            var note = document.getElementById("note_receive").value;
        } else {
            alert("Pls Fill Note (Why You Reject This Receive?)");
            return;
        }
        $.ajax({
            type: "Post",
            url: "/Receive/Manage_Reject?id=" + id + "&note=" + note,
            async: false,
            contentType: false,
            processData: false,
            success: function (data) {
                alert("OK");
                modal_reject.style.display = "none";
                modal.style.display = "none";
                location.reload();
            },
            error: function (err) {
                //debugger
                alert("FAIL!");
            }
        });
    }
    function Add_Manager_Confirm() {
        var id = document.getElementById("receive_id").value;
        if ($("#manager_add").val() != 0) {
            var manager_id = $("#manager_add").val();
        } else {
            alert("Pls Select Manager!");
            return;
        }
        var manager_name = $("#manager_add option:selected").text();
        var data = new FormData;
        data.append("receive_id", id);
        data.append("add_manager", manager_id);
        data.append("add_manager_name", manager_name);
        $.ajax({
            type: "Post",
            url: "/Receive/Add_Manager_Confirm",
            data: data,
            async: false,
            contentType: false,
            processData: false,
            success: function (data) {
                if (data == "OK") {
                    modal.style.display = "none";
                    location.reload();
                } else {
                    alert("Fail");
                }
            },
            error: function (err) {
                //debugger
                alert("FAIL!");
            }
        });
    }
    function Add_Manager_Confirm1() {
        var id = document.getElementById("receive_id").value;
        if ($("#manager_add1").val() != 0) {
            var manager_id = $("#manager_add1").val();
        } else {
            alert("Pls Select Manager!");
            return;
        }
        var manager_name = $("#manager_add1 option:selected").text();
        var data = new FormData;
        data.append("receive_id", id);
        data.append("add_manager", manager_id);
        data.append("add_manager_name", manager_name);
        $.ajax({
            type: "Post",
            url: "/Receive/Add_Manager_Confirm",
            data: data,
            async: false,
            contentType: false,
            processData: false,
            success: function (data) {
                if (data == "OK") {
                    modal.style.display = "none";
                    location.reload();
                } else {
                    alert("Fail");
                }
            },
            error: function (err) {
                //debugger
                alert("FAIL!");
            }
        });
    }
    function convert_date(date) {
        var completedDate = new Date(parseInt(date.replace("/Date(", "").replace(")/")));
        var dd = completedDate.getDate();
        var mm = completedDate.getMonth() + 1; //January is 0!
        var yyyy = completedDate.getFullYear();
        if (dd < 10) { dd = '0' + dd }
        if (mm < 10) { mm = '0' + mm }
        return dd + '-' + mm + '-' + yyyy;
    }
    $("#input_search").on("keyup", function () {
        //get the input value, trimmed, and lowercased
        var value = this.value.trim().toLowerCase();
        //get the associated table
        var $table;
        if (tab == "tbl_Receive") {
            $table = $("#tbdReceive");
        } else if (tab == "tbl_Receive1") {
            $table = $("#tbdReceive1");
        }
        //show all the rows to "undo" previous filtering
        $table.find('tr').show();

        //only filter if the value is not blank
        if (value) {
            $table.find('thead tr').show();
            //find all the rows that do not match the filter, and hide them
            $table.find('tr').filter(function () {
                return this.innerText.toLowerCase().indexOf(value) < 0;
            }).hide();
        }
    });
</script>

