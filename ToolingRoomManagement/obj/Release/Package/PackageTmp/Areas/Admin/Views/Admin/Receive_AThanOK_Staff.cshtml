@model List<Model.EF.Receive>
@{
    ViewBag.Title = "Receive_AThanOK_Staff";
    Layout = "~/Areas/Admin/Views/Shared/_Layout_AdminPage.cshtml";
    var listManager = (List<Model.EF.User>)ViewBag.listManager;
    int dem = 0;
}

<style>
    @@media (min-width: 900px) {
        .modal-sm {
            width: 900px;
        }
    }

    @@media (min-width: 900px) {
        .modal-content {
            -webkit-box-shadow: 0 5px 15px rgba(0,0,0,.5);
            box-shadow: 0 5px 15px rgba(0,0,0,.5);
        }
    }

    .tblCreate thead tr th {
        text-align: center;
    }

    .tblCreate tbody tr td {
        text-align: center;
    }
    .project-list {
        display: -webkit-box;
        display: flex;
        flex-wrap: wrap;
        padding-bottom: 3rem;
    }

    .project-item {
        width: 33.333%;
        padding: .5rem;
        -webkit-transition: 400ms ease;
        transition: 400ms ease;
    }

        .project-item .item-inner {
            padding-bottom: 0;
            border-radius: 5px;
            background: #152036;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.32);
            -webkit-transition: 400ms;
            transition: 400ms;
        }

    .item-inner .content {
        padding: 1.5rem;
    }

        .item-inner .content h3 {
            margin-top: 0;
            color: #84bf7d;
        }

        .item-inner .content p {
            margin-bottom: 1rem;
            color: #ecece7;
        }

    .item-inner .item-footer {
        display: flex;
        -webkit-box-pack: justify;
        justify-content: space-between;
        padding: .75rem;
        padding-bottom: .25rem;
        background: #1c2f52;
        border-top: 1px solid #ddd;
        color: #f3ebeb;
        border-bottom-left-radius: 5px;
        border-bottom-right-radius: 5px;
    }


        .item-inner .item-footer .item-person {
            position: relative;
            top: -4px;
        }

            .item-inner .item-footer .item-person img {
                height: 1.75rem;
                width: 1.75rem;
                border-radius: 50%;
            }

            .item-inner .item-footer .item-person span {
                margin-left: .5rem;
            }

        .item-inner .item-footer .date {
            position: relative;
            top: 3px;
            margin: 0;
        }

            .item-inner .item-footer .date h5 {
                margin: 0;
            }
    .zoom {
        transition: transform .5s;
    }

        .zoom:hover {
            transform: scale(1.1); /* (150% zoom - Note: if the zoom is too large, it will go outside of the viewport) */
        }
         #tbl_View thead tr th {
        font-size: 1.5vh;
        color: white;
        background: #5c7096;
        position: sticky;
        top: -3px;
        font-size: 1.3vh;
        text-align: center;
    }

    #tbl_View thead {
        
        position: sticky;
        top: -3px;
        font-size: 1.3vh;
        text-align: center;
    }

    #tbl_View tbody tr td {
        font-size: 1vh;
        color: white;
        text-align: center;
    }
     ::-webkit-scrollbar {
        width: 8px;
        height: 5px;
    }

    ::-webkit-scrollbar-thumb {
        -webkit-box-shadow: inset 0 0 4px 9px rgba(0,0,0,0.3);
        border-radius: 10px;
    }
    .load_section {
        animation: animateLoad 10s linear infinite;
    }
  .load_section .loader{
			position: relative;
			width: 5vw;
			height: 5vh;
            margin-top: 30vh;
            margin-left: 38vw;
		}
		.load_section .loader .span_loader{
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			transform: rotate(calc(18deg * var(--i)));
		}
		.load_section .loader .span_loader::before{
			content: '';
			position: absolute;
			border-radius: 20px;
			top: 0;
			left: 0;
			width: 10px;
			height: 10px;
			background: #ffc107;
			box-shadow: 0 0 10px #ffc107, 
                        0 0 20px #ffc107, 
                        0 0 40px #ffc107, 
                        0 0 60px #ffc107, 0 0 80px #007bff, 
                        0 0 100px #007bff;
			animation: animateChild 1s linear infinite;
			animation-delay: calc(0.05s * var(--i));
		}
		@@keyframes animateLoad{
			0%{
				filter: hue-rotate(0deg);
			}
			100%{
				filter: hue-rotate(360deg);
			}
		}
		@@keyframes animateChild{
			0%{
				transform: scale(1);
			}
			80%,100%{
				transform: scale(0);
			}
		}
</style>
<div class="header-advance-area">

    
    <div class="breadcome-area" style=" margin-top: 40px;">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="breadcome-list">
                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                <div class="breadcomb-wp">
                                    <div class="breadcomb-icon zoom" data-toggle="tooltip" data-placement="bottom" title="Home">
                                        <a href="/Admin/Admin/StaffPage">
                                            <i class="icon nalika-home"></i>
                                        </a>
                                    </div>
                                    <div class="breadcomb-ctn">
                                        <h2 langKey="">Đơn Lĩnh</h2>
                                        <p>Welcome to Tooling <span class="bread-ntd">Room</span></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                <div class="breadcomb-report">
                                    <button data-toggle="tooltip" data-placement="left" title="Download Report" class="btn"><i class="icon nalika-download"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="product-sales-area mg-tb-30" style="height:685px;margin:0px;">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="product-sales-chart">
                    <div class="portlet-title">
                        <div class="row">
                            <div class="content">
                                <div class="" style="">
                                    <div class="project-list" style="padding:0">
                                        <div style="width:100%;">
                                            <div class="ng-isolate-scope" style="float:left;width:11%; border-radius: 5px;">
                                                <select id="select_status" style="height: 28px;color: white;width: 100%;padding-left: 15px; border-radius: 5px;background: #152036;">
                                                    <option value="100">Wait Order</option>
                                                    <option value="3">Reject Order</option>
                                                    <option value="4">Complete Order</option>
                                                </select>

                                            </div>
                                            <div class="col-lg-2 col-md-7 col-sm-6 col-xs-12" style="float:right;width: 300px;margin-right:25px;">
                                                <div class="header-top-menu tabl-d-n hd-search-rp">
                                                    <div class="breadcome-heading" style="margin: 0px 0px 0px 0px;">
                                                        <form role="search" class="">
                                                            <input id="input_search" type="text" placeholder="Search..." class="form-control" style="width: 283px;color: #fffaf0;height: 35px;" />
                                                            <a href="" style="left: 257px;margin-top: -23px;"><i class="fa fa-search"></i></a>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <p style="color:white;"><a style="color:white;">Trang:</a> <div id="number_page" style=""></div><div><a style="color:white;">Bạn đang ở trang: </a><a id="page_num"></a></div></p>
                                        <div style="height:60vh;overflow:auto;width:100%;">
                                            <table class="table table-bordered" id="tbl_View">
                                                <thead>
                                                    <tr>
                                                        <th rowspan="2" style="width:3%;">No</th>
                                                        <th rowspan="2" style="width:6%;">Code</th>
                                                        <th rowspan="2" style="width:7%;">Content</th>
                                                        <th rowspan="2" style="width:5%;">Status</th>
                                                        <th rowspan="1" colspan="3">Create By</th>
                                                        <th rowspan="1" colspan="3">Manager</th>
                                                        <th rowspan="1" colspan="3">C Than</th>
                                                        <th rowspan="1" colspan="3">Transfer</th>
                                                        <th rowspan="1" colspan="3">Thuy</th>
                                                    </tr>
                                                    <tr>
                                                        <th colspan="1" style="width:6%;">Name</th>
                                                        <th colspan="1" style="width:6%;">Date</th>
                                                        <th colspan="1" style="width:6%;">Note</th>
                                                        <th colspan="1" style="width:6%;">Name</th>
                                                        <th colspan="1" style="width:6%;">Date</th>
                                                        <th colspan="1" style="width:6%;">Note</th>
                                                        <th colspan="1" style="width:6%;">Name</th>
                                                        <th colspan="1" style="width:6%;">Date</th>
                                                        <th colspan="1" style="width:6%;">Note</th>
                                                        <th colspan="1" style="width:5%;">Name</th>
                                                        <th colspan="1" style="width:5%;">Date</th>
                                                        <th colspan="1" style="width:5%;">Note</th>
                                                        <th colspan="1" style="width:5%;">Name</th>
                                                        <th colspan="1" style="width:5%;">Note</th>
                                                        <th colspan="1" style="width:5%;">Date</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tbd_View"></tbody>
                                            </table>
                                            <section class="load_section" style="width: 100%;">
                                                <div class="loader">
                                                    <span class="span_loader" style="--i:1;"></span>
                                                    <span class="span_loader" style="--i:2;"></span>
                                                    <span class="span_loader" style="--i:3;"></span>
                                                    <span class="span_loader" style="--i:4;"></span>
                                                    <span class="span_loader" style="--i:5;"></span>
                                                    <span class="span_loader" style="--i:6;"></span>
                                                    <span class="span_loader" style="--i:7;"></span>
                                                    <span class="span_loader" style="--i:8;"></span>
                                                    <span class="span_loader" style="--i:9;"></span>
                                                    <span class="span_loader" style="--i:10;"></span>
                                                    <span class="span_loader" style="--i:11;"></span>
                                                    <span class="span_loader" style="--i:12;"></span>
                                                    <span class="span_loader" style="--i:13;"></span>
                                                    <span class="span_loader" style="--i:14;"></span>
                                                    <span class="span_loader" style="--i:15;"></span>
                                                    <span class="span_loader" style="--i:16;"></span>
                                                    <span class="span_loader" style="--i:17;"></span>
                                                    <span class="span_loader" style="--i:18;"></span>
                                                    <span class="span_loader" style="--i:19;"></span>
                                                    <span class="span_loader" style="--i:20;"></span>
                                                </div>
                                            </section>
                                        </div>
                                       
                                        @*@if (Model.Count() != 0)
                                        {
                                            foreach (var receive in Model)
                                            {
                                                { dem++; }
                                                <a class="project-item zoom" onclick="deltail('@receive.id','@receive.code_receive.Substring(0,1)')">
                                                    <div class="item-inner">
                                                        <div class="content">
                                                            <h3><b langKey="order">Đơn</b> @receive.code_receive</h3>
                                                            <p>@receive.receive_name</p>
                                                            <h5><b langKey="manager_confirm">Quản lý xác nhận:</b> @receive.manager_confirm, @(receive.add_manager_name != null ? receive.add_manager_name : "")</h5>
                                                        </div>
                                                        <div class="item-footer">
                                                            <div class="item-person"><img src="/Assets/img/100px-user-100.jpg"><span>@receive.create_by</span></div>
                                                            <div class="date">
                                                                <h5>@receive.create_date.Value.ToString("dd/MM/yyyy")</h5>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </a>
                                            }
                                        }
                                        else
                                        {
                                            <h4 style="color:#fff" langKey="notyet">Chưa có đơn!</h4>
                                        }*@
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>
<!-- The Modal -->
<div class="modal" id="myModal">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Detail Order</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <input hidden id="receive_id" />
                <table class="table table-dark tblCreate">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th langKey="name_device">Tên TB</th>
                            <th langKey="location">Kho</th>
                            <th langKey="quantity">Số lượng</th>
                            <th langKey="type">Type</th>
                            <th>Ngày trả</th>
                            <th langKey="note">Ghi chú</th>
                            <th langKey="action">Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="tblReceive" style="text-align:center;"></tbody>
                </table>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btnclose" langKey="close">Đóng</button>
                <button type="button" class="btn btn-secondary btnComplete" onclick="Complete()" style="background: green;color: white;" langKey="">Hoàn thành</button>
                <button type="button" class="btn btn-secondary btnReject" onclick="openReject()" style="background: red;color: white;" langKey="">Trả về</button>
            </div>

        </div>
    </div>
</div>
<div class="modal" id="ModalDeviceBackRoom">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Chi tiết</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <input hidden id="receive_back" />

                <table class="" style="border:0;margin-left: 60px;" id="tblBack">
                    <tr>
                        <td style="width: 150px;height: 50px;" langKey="code_inventory">Mã Kiểm kê: </td>
                        <td class="makiemke"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;" langKey="code_SN">Mã SN: </td>
                        <td class="maSN"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;" langKey="name_device">Tên TB: </td>
                        <td class="tenTB"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;" >Model: </td>
                        <td class="model_TB"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;" langKey="calibration">Mã Hiệu chuẩn: </td>
                        <td class="mahieuchuan"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;" langKey="location">Nhập vào kho : </td>
                        <td class="kho_TB"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;" langKey="status_device">Tình trạng TB: </td>
                        <td class="statusTB"></td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;" langKey="note">Ghi chú: </td>
                        <td class="noteTB"></td>
                    </tr>
                    <tr class="image_TB">
                        <td style="width: 150px;height: 50px;" langKey="image">Hình ảnh: </td>
                        <td class="imageTB">
                            @*<input type="file" class="form-control TYPEDEVICE" style="background-color:white;color:black;border: 1px solid #5c7096;border-radius: 21px;" id="imageTB" multiple>*@

                        </td>
                    </tr>


                </table>

            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btnclose" langKey="close">Đóng</button>
                <button type="button" class="btn btn-secondary btnAdd" onclick="Confirm_Back()" langKey="get">Nhận</button>

            </div>

        </div>
    </div>
</div>
<div class="modal" id="myModal_Reject" style="z-index:10000">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Reject Note</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <input hidden id="id_receive" />
                <textarea class="form-control" id="note_receive" style="color: #000;border-radius: 11px; margin-left: 100px;width: 80%;background: aliceblue; height: 80px;border: 1px solid #d4abab;"></textarea>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" style="background: red;color: white;" class="btn btn-secondary btnreject" onclick="reject()">Submit</button>
            </div>

        </div>
    </div>
</div>
<script src="/Assets/admin/js/vendor/jquery-1.12.4.min.js"></script>
<script>
    var modal = document.getElementById("myModal");
    var modalDeviceBackRoom = document.getElementById("ModalDeviceBackRoom");
    var modal_reject = document.getElementById("myModal_Reject");
    $(document).on("click", ".close", function () {
        modal.style.display = "none";
        modalDeviceBackRoom.style.display = "none";
        modal_reject.style.display = "none";
    })
    $(document).on("click", ".btnclose", function () {
        modal.style.display = "none";
        modalDeviceBackRoom.style.display = "none";
    })
    $(".load_section").show();
    $("#select_status").change(function () {
        $(".load_section").show();
        $("#tbd_View").hide();
        var st = $("#select_status").val();
        //alert(st);
        loadData(st,1)
    })

    function loadData(st,number) {
        $.ajax({
            type: "POST",
            url: "/Receive/getReceiveGet?status="+st+"&numberPage="+number,
            //data:data,
            contentType: "application/json",
            datatype: "json/text",
            success: function (result) {
                var row = "";
                var row1 = "";
                var data = "";
                var number_page = "";
                if (st == 4) {
                    data = result.split('___')[0];
                    for (i = 0; i < parseInt(result.split('___')[1]); i++) {
                        number_page += '<a style="margin-right:2vw;cursor:pointer;" onclick="loadData(' + "'" + st + "','" + (i + 1) + "'" + ')"><u>' + (i + 1) + '</u></a>';
                    }
                }

                else {
                    data = result;
                }
                if (JSON.parse(data).length > 0) {
                    for (i = 0; i < JSON.parse(data).length; i++) {
                        var status = "";
                        if (JSON.parse(data)[i].receive.status == 1) {
                            status = '<a style="color:orange;">Wait_Manager<a>';
                        } else if (JSON.parse(data)[i].receive.status == 2) {
                            status = '<a style="color:#00adff;">Wait_CThan<a>';
                        } else if (JSON.parse(data)[i].receive.status == 7) {
                            status = '<a style="color:orange;">Thuy_Check<a>';
                        } else if (JSON.parse(data)[i].receive.status == 6) {
                            status = '<a style="color:#00ffa1;">Wait_Transfer<a>';
                        } else if (JSON.parse(data)[i].receive.status == 3) {
                            status = '<a style="color:red;">Reject<a>';
                        } else if (JSON.parse(data)[i].receive.status == 4) {
                            status = '<a style="color:green;">OK<a>';
                        } else if (JSON.parse(data)[i].receive.status == 5) {
                            status = '<a style="color:yellow;">Wait_Get<a>';
                        }
                        row += '<tr style="" onclick="detail(' + "'" + JSON.parse(data)[i].receive.id + "','" + JSON.parse(data)[i].receive.status + "'" + ')">' +
                            '<td>' + (i + 1) + '</td>' +
                            '<td>' + JSON.parse(data)[i].receive.code_receive + '</td>' +
                            '<td>' + JSON.parse(data)[i].receive.receive_name + '</td>' +
                            '<td>' + status + '</td>' +
                            '<td>' + JSON.parse(data)[i].fullname+ '</td>' +
                            '<td>' + (JSON.parse(data)[i].receive.create_date != null ? convert_date(JSON.parse(data)[i].receive.create_date) : "") + '</td>' +
                            '<td style="width: 5%;">' + (JSON.parse(data)[i].receive.note != null ? JSON.parse(data)[i].receive.note : "") + '</td>' +
                            '<td style="width: 5%;">' + JSON.parse(data)[i].receive.manager_confirm + '</td>' +
                            '<td>' + (JSON.parse(data)[i].receive.time_manager_cf != null ? convert_date(JSON.parse(data)[i].receive.time_manager_cf) : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].receive.note_manager != null ? JSON.parse(data)[i].receive.note_manager : "") + '</td>' +
                            '<td style="width: 5%;">C.Than</td>' +
                            '<td>' + (JSON.parse(data)[i].receive.time_CThanConfirm != null ? convert_date(JSON.parse(data)[i].receive.time_CThanConfirm) : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].receive.note_cThan != null ? JSON.parse(data)[i].receive.note_cThan : "") + '</td>' +
                            '<td style="width:5%;">' + (JSON.parse(data)[i].receive.add_manager_name != null ? JSON.parse(data)[i].receive.add_manager_name : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].receive.time_transfer_cf != null ? convert_date(JSON.parse(data)[i].receive.time_transfer_cf) : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].receive.note_manager != null ? JSON.parse(data)[i].receive.note_manager : "") + '</td>' +
                            '<td style="width: 5%;">Thuy</td>' +
                            '<td>' + (JSON.parse(data)[i].receive.note_Thuy != null ? JSON.parse(data)[i].receive.note_Thuy : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].receive.complete_date != null ? convert_date(JSON.parse(data)[i].receive .complete_date) : "") + '</td>' +
                            +'</tr>';
                    }
                } else {
                    row = '<tr>' +
                        '<td colspan="18" style="text-align:center;color:white;">-----No Data-----</td>' +
                        '</tr>';
                }
                $("#page_num").empty();
                $("#page_num").append(number)
                $("#number_page").empty();
                $("#number_page").append(number_page);
                $("#tbd_View").empty();
                $("#tbd_View").append(row);
                $(".load_section").hide();
                $("#tbd_View").show();
                tab = "tbl_Receive";

                //show_table("tbdReceive");
                //$("#tbdReceive1").append(row1);
            },
            error: function (returnval) {
            }
        });
    }
    loadData(100, 1);
    
    $(".btnComplete").hide();
    $(".btnReject").hide();
    function detail(receive_id, status) {
        $(".imageTB").empty();
        $("#receive_id").val(receive_id);
        $("#tblReceive").empty();
        if (status != 4) {
            $.ajax({
                type: "Post",
                url: "/Receive/get_ClipOutput_Receive?receive_id=" + receive_id,
                async: false,
                contentType: false,
                processData: false,
                success: function (data) {
                    //alert(data);
                    //debugger
                    var length = JSON.parse(data).length;
                    var row = "";
                    //if (length == 0) {
                    //    alert("Dont have any device!");
                    //    return;
                    //}
                    for (i = 0; i < length; i++) {
                        var type = "";
                        if (JSON.parse(data)[i].clipOutput.type == 1) {
                            type = "Lĩnh";
                        } else if (JSON.parse(data)[i].clipOutput.type == 2) {
                            type = "Đổi";
                        } else {
                            type = "Mượn";
                        }
                        var note = "";
                        if (JSON.parse(data)[i].clipOutput.note != null) {
                            var a = JSON.parse(data)[i].clipOutput.note.replace("\n", " ");
                            note = a.replace("\n", " ");
                        }
                        else {
                            note = "";
                        }
                        var ngaytra = "";
                        if (JSON.parse(data)[i].clipOutput.ngaytra != null) {
                            ngaytra = convert_date(JSON.parse(data)[i].clipOutput.ngaytra);

                        } else {
                            ngaytra = "";
                        }
                        var confirm = "'" + JSON.parse(data)[i].clipOutput.quantity + "','" + JSON.parse(data)[i].clipOutput.device_id + "','" + JSON.parse(data)[i].clipOutput.receive_id + "','" + JSON.parse(data)[i].clipOutput.id + "','" + JSON.parse(data)[i].clipOutput.type + "','" + note + "','" + ngaytra + "'";
                        var dele = "'" + JSON.parse(data)[i].clipOutput.id + "','" + JSON.parse(data)[i].clipOutput.receive_id + "'";
                        if (status == 5) {
                            button = '<button class="btnConfirm" style="background: lightgreen;border: 1px solid gray;border-radius: 5px;" onclick="confirm(' + confirm + ')">OK</button>' +
                                '<button class="btnDelete" hidden style="background: red;border: 1px solid gray;border-radius: 5px;" onclick="Delete(' + dele + ')">Delete</button>';
                            $(".btnComplete").show();
                            $(".btnReject").show();
                        } else {
                            button = "";
                            $(".btnComplete").hide();
                            $(".btnReject").hide();
                        }
                        
                        row = row + '<tr>' +
                            '<td>' + (i + 1) + '</td>' +
                            '<td>' + JSON.parse(data)[i].device_name + '</td>' +
                            '<td>' + JSON.parse(data)[i].location + '</td>' +
                            '<td class="quantity">' + JSON.parse(data)[i].clipOutput.quantity + '</td>' +
                            '<td>' + type + '</td>' +
                            '<td>' + ngaytra + '</td>' +
                            '<td>' + note + '</td>' +
                            '<td>' +button+'</td>' +
                            '</tr>';
                    }
                    $("#tblReceive").append(row);
                    
                    modal.style.display = "block";
                },
                error: function (err) {
                    //debugger
                    alert("FAIL!");
                }
            });
        } else {
            $.ajax({
                type: "Post",
                url: "/Receive/get_Output_Receive?receive_id=" + receive_id,
                async: false,
                contentType: false,
                processData: false,
                success: function (data) {
                    //alert(data);
                    //debugger
                    var length = JSON.parse(data).length;
                    var row = "";
                    //if (length == 0) {
                    //    alert("Dont have any device!");
                    //    return;
                    //}
                    for (i = 0; i < length; i++) {
                        var type = "";
                        if (JSON.parse(data)[i].output.type == 1) {
                            type = "Lĩnh";
                        } else if (JSON.parse(data)[i].output.type == 2) {
                            type = "Đổi";
                        } else {
                            type = "Mượn";
                        }
                        var note = "";
                        if (JSON.parse(data)[i].output.note != null) {
                            var a = JSON.parse(data)[i].output.note.replace("\n", " ");
                            note = a.replace("\r", " ");
                        }
                        else {
                            note = "";
                        }
                        debugger
                        var ngaytra = "";
                        if (JSON.parse(data)[i].output.ngaytra != null) {
                            ngaytra = convert_date(JSON.parse(data)[i].output.ngaytra);

                        } else {
                            ngaytra = "";
                        }

                        row = row + '<tr>' +
                            '<td>' + (i + 1) + '</td>' +
                            '<td>' + JSON.parse(data)[i].device_name + '</td>' +
                            '<td>' + JSON.parse(data)[i].location + '</td>' +
                            '<td class="quantity">' + JSON.parse(data)[i].output.quantity_output + '</td>' +
                            '<td>' + type + '</td>' +
                            '<td>' + ngaytra + '</td>' +
                            '<td>' + note + '</td>' +
                            '<td>'+
                            '</td>' +
                            '</tr>';
                    }
                    $("#tblReceive").append(row);
                    if (status == 5) {
                        button = '<button class="btnConfirm" style="background: lightgreen;border: 1px solid gray;border-radius: 5px;" onclick="confirm(' + confirm + ')">OK</button>' +
                            '<button class="btnDelete" hidden style="background: red;border: 1px solid gray;border-radius: 5px;" onclick="Delete(' + dele + ')">Delete</button>';
                        $(".btnComplete").show();
                        $(".btnReject").show();
                    } else {
                        button = "";
                        $(".btnComplete").hide();
                        $(".btnReject").hide();
                    }
                    modal.style.display = "block";
                },
                error: function (err) {
                    //debugger
                    alert("FAIL!");
                }
            });
        }
        
    }
    function confirm(quantity, device_id, receive_id, clip_id, type, note,ngaytra) {
        debugger
        $.ajax({
            type: "Post",
            url: "/Device/check_Quantity?device_id=" + device_id + "&quantity=" + quantity,
            async: false,
            cache: false,
            timeout: 30000,
            contentType: false,
            processData: false,
            success: function (data) {
                debugger
                var a = "";
                if (data == "0") {
                    alert("Thiết bị này đã hết!");
                    $(".btnConfirm").hide();
                    $(".btnDelete").show();
                    return;
                } else {
                    var data = new FormData;
                    data.append("quantity", quantity);
                    data.append("device_id", device_id);
                    data.append("receive_id", receive_id);
                    data.append("clip_id", clip_id);
                    data.append("type", type);
                    data.append("note", note);
                    data.append("ngaytra", ngaytra);
                    $.ajax({
                        type: "Post",
                        url: "/Receive/staff_Confirm",
                        data: data,
                        async: false,
                        contentType: false,
                        processData: false,
                        success: function (data) {
                            alert("OK");
                            deltail(receive_id);
                        },
                        error: function (err) {
                            //debugger
                            alert("FAIL!");
                        }
                    });
                }
            },
            error: function (err) {
                debugger
                alert("FAIL!");
            }
        });

    }
    function Confirm_Back() {
        var SN_TB = $("#SN_TB").text();
        var makiemke = $("#makiemke").text();
        $.ajax({
            type: "Post",
            url: "/Receive/Insert_DeviceBack?maSN=" + SN_TB + "&makiemke=" + makiemke,
            async: false,
            contentType: false,
            processData: false,
            success: function (data) {
                if (data == "OK") {
                    alert("OK");
                    location.reload();
                } else {
                    alert("Nhận TB không thành công!");
                }
            },
            error: function (err) {
                //debugger
                alert("FAIL!");
            }
        });
        //var receive_back = document.getElementById("receive_back").value;
        //$.ajax({
        //    type: "Post",
        //    url: "/Receive/Complete?id=" + receive_id,
        //    async: false,
        //    contentType: false,
        //    processData: false,
        //    success: function (data) {
        //        alert("OK");
        //        modal.style.display = "none";
        //        location.reload();
        //    },
        //    error: function (err) {
        //        //debugger
        //        alert("FAIL!");
        //    }
        //});
    }
    function Delete(id,receive_id){
        $.ajax({
            type: "Post",
            url: "/ClipOutput/Delete?id=" + id,
            async: false,
            contentType: false,
            processData: false,
            success: function (data) {
                alert("OK");
                modal.style.display = "none";

                deltail(receive_id);
            },
            error: function (err) {
                //debugger
                alert("FAIL!");
            }
        });
    }
    function Complete() {
        debugger
        var receive_id = document.getElementById("receive_id").value;
        $.ajax({
            type: "Post",
            url: "/Receive/Complete?id=" + receive_id,
            async: false,
            contentType: false,
            processData: false,
            success: function (data) {
                alert("OK");
                modal.style.display = "none";
                location.reload();
            },
            error: function (err) {
                //debugger
                alert("FAIL!");
            }
        });
    }
    function openReject() {
        var id = $("#receive_id").val();
        $("#id_receive").val(id);
        modal_reject.style.display = "block";
    }
    function reject() {
        var id = document.getElementById("id_receive").value;
        if ($("#note_receive").val() != "") {
            var note = document.getElementById("note_receive").value;
        } else {
            alert("Pls Fill Note (Why You Reject This Receive?)");
        }
        $.ajax({
            type: "Post",
            url: "/Receive/Thuy_Reject?id=" + id + "&note=" + note,
            async: false,
            contentType: false,
            processData: false,
            success: function (data) {
                alert("OK");
                modal_reject.style.display = "none";
                modal.style.display = "none";
                location.reload();
            },
            error: function (err) {
                //debugger
                alert("FAIL!");
            }
        });
    }
    $("#input_search").on("keyup", function () {
        //get the input value, trimmed, and lowercased
        var value = this.value.trim().toLowerCase();
        //get the associated table
        var $table;
        $table = $("#tbd_View");

        //show all the rows to "undo" previous filtering
        $table.find('tr').show();

        //only filter if the value is not blank
        if (value) {
            $table.find('thead tr').show();
            //find all the rows that do not match the filter, and hide them
            $table.find('tr').filter(function () {

                return this.innerText.toLowerCase().indexOf(value) < 0;
            }).hide();
        }
    });
    function convert_date(date) {
        var completedDate = new Date(parseInt(date.replace("/Date(", "").replace(")/")));
        var dd = completedDate.getDate();
        var mm = completedDate.getMonth() + 1; //January is 0!
        var yyyy = completedDate.getFullYear();
        if (dd < 10) { dd = '0' + dd }
        if (mm < 10) { mm = '0' + mm }
        return dd + '-' + mm + '-' + yyyy;
    }
</script>


