@model List<Model.EF.Receive>
@{
    ViewBag.Title = "Receive_User_Reject";
    Layout = "~/Areas/Admin/Views/Shared/_Layout_AdminPage.cshtml";
    var listAllDevice = (List<Model.EF.Device>)ViewBag.listAllDevice;
    int dem1 = 0;
}
<link href="~/Assets/admin/bootstrap-select.css" rel="stylesheet" />
@*<script src="~/Assets/client/vendor/jquery/jquery.min.js"></script>*@
<script src="/Assets/admin/js/vendor/jquery-1.12.4.min.js"></script>
<script src="/Assets/admin/bootstrap-select.js"></script>
<style>
    @@media (min-width: 900px) {
        .modal-sm {
            width: 900px;
        }
    }

    @@media (min-width: 900px) {
        .modal-content {
            -webkit-box-shadow: 0 5px 15px rgba(0,0,0,.5);
            box-shadow: 0 5px 15px rgba(0,0,0,.5);
        }
    }

    .tblCreate thead tr th {
        text-align: center;
    }

    .tblCreate tbody tr td {
        text-align: center;
    }

    .project-list {
        display: -webkit-box;
        display: flex;
        flex-wrap: wrap;
        padding-bottom: 3rem;
    }

    .project-item {
        width: 33.333%;
        padding: .5rem;
        -webkit-transition: 400ms ease;
        transition: 400ms ease;
    }

        .project-item .item-inner {
            padding-bottom: 0;
            border-radius: 5px;
            background: #152036;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.32);
            -webkit-transition: 400ms;
            transition: 400ms;
        }

    .item-inner .content {
        padding: 1.5rem;
    }

        .item-inner .content h3 {
            margin-top: 0;
            color: #84bf7d;
        }

        .item-inner .content p {
            margin-bottom: 1rem;
            color: #ecece7;
        }

    .item-inner .item-footer {
        display: flex;
        -webkit-box-pack: justify;
        justify-content: space-between;
        padding: .75rem;
        padding-bottom: .25rem;
        background: #1c2f52;
        border-top: 1px solid #ddd;
        color: #f3ebeb;
        border-bottom-left-radius: 5px;
        border-bottom-right-radius: 5px;
    }


        .item-inner .item-footer .item-person {
            position: relative;
            top: -4px;
        }

            .item-inner .item-footer .item-person img {
                height: 1.75rem;
                width: 1.75rem;
                border-radius: 50%;
            }

            .item-inner .item-footer .item-person span {
                margin-left: .5rem;
            }

        .item-inner .item-footer .date {
            position: relative;
            top: 3px;
            margin: 0;
        }

            .item-inner .item-footer .date h5 {
                margin: 0;
            }

    .zoom {
        transition: transform .5s;
    }

        .zoom:hover {
            transform: scale(1.1); /* (150% zoom - Note: if the zoom is too large, it will go outside of the viewport) */
        }

    #tbl_View {
        color: white;
    }

        #tbl_View thead {
            position: sticky;
            top: -3px;
            font-size: 1.3vh;
            background: #1b2a47;
        }

            #tbl_View thead tr th {
                text-align: center;
            }

        #tbl_View tbody tr td {
            font-size: 1vh;
            color: white;
            text-align: center;
        }

    ::-webkit-scrollbar {
        width: 8px;
        height: 5px;
    }

    ::-webkit-scrollbar-thumb {
        -webkit-box-shadow: inset 0 0 4px 9px rgba(0,0,0,0.3);
        border-radius: 10px;
    }

    .load_section {
        animation: animateLoad 10s linear infinite;
    }

        .load_section .loader {
            position: relative;
            width: 5vw;
            height: 5vh;
            margin-top: 30vh;
            margin-left: 38vw;
        }

            .load_section .loader .span_loader {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                transform: rotate(calc(18deg * var(--i)));
            }

                .load_section .loader .span_loader::before {
                    content: '';
                    position: absolute;
                    border-radius: 20px;
                    top: 0;
                    left: 0;
                    width: 10px;
                    height: 10px;
                    background: #ffc107;
                    box-shadow: 0 0 10px #ffc107, 0 0 20px #ffc107, 0 0 40px #ffc107, 0 0 60px #ffc107, 0 0 80px #007bff, 0 0 100px #007bff;
                    animation: animateChild 1s linear infinite;
                    animation-delay: calc(0.05s * var(--i));
                }

    @@keyframes animateLoad {
        0% {
            filter: hue-rotate(0deg);
        }

        100% {
            filter: hue-rotate(360deg);
        }
    }

    @@keyframes animateChild {
        0% {
            transform: scale(1);
        }

        80%,100% {
            transform: scale(0);
        }
    }

    #tblBack tr td {
        text-align: center;
    }

    #table_View_Back tbody tr td {
        word-break: break-all;
    }

    #table_View_Back thead tr th {
        background: wheat;
        position: sticky;
        top: -3px;
    }
</style>
<div class="header-advance-area">
    <div class="breadcome-area" style=" margin-top: 40px;">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="breadcome-list">
                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                <div class="breadcomb-wp">
                                    <div class="breadcomb-icon zoom" data-toggle="tooltip" data-placement="bottom" title="Home">
                                        <a href="/Admin/Admin/UserPage">
                                            <i class="icon nalika-home"></i>
                                        </a>
                                    </div>
                                    <div class="breadcomb-ctn">
                                        <h2>Đơn trả kho</h2>
                                        <p>Welcome to Tooling <span class="bread-ntd">Room</span></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                <div class="breadcomb-report">
                                    <button data-toggle="tooltip" data-placement="left" title="Download Report" class="btn"><i class="icon nalika-download"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="product-sales-area mg-tb-30" style="height:685px;">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="product-sales-chart">
                    <div class="portlet-title">
                        <div class="row">
                            <div class="content">
                                <div class="" style="">
                                    <div class="project-list">
                                        <div style="width:100%;">
                                            <div class="ng-isolate-scope" style="float:left;width:11%; border-radius: 5px;">
                                                <select id="select_status" style="height: 28px;color: white;width: 100%;padding-left: 15px; border-radius: 5px;background: #152036;">
                                                    <option value="100">Đơn chờ</option>
                                                    <option value="3">Đơn bị trả về</option>
                                                    <option value="4">Đơn đã hoàn thành</option>
                                                </select>

                                            </div>
                                            <div class="col-lg-2 col-md-7 col-sm-6 col-xs-12" style="float:right;width: 300px;margin-right:25px;">
                                                <div class="header-top-menu tabl-d-n hd-search-rp">
                                                    <div class="breadcome-heading" style="margin: 0px 0px 10px 0px;">
                                                        <form role="search" class="">
                                                            <input id="input_search" type="text" placeholder="Search..." class="form-control" style="width: 283px;color: #fffaf0;height: 39px;" />
                                                            <a href="" style="left: 257px;margin-top: -23px;"><i class="fa fa-search"></i></a>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div style="height:68vh;overflow:auto;width:100%;">
                                            <table class="table table-bordered" id="tbl_View">
                                                <thead>
                                                    <tr>
                                                        <th rowspan="2" style="width:3%;">#</th>
                                                        <th rowspan="2" style="width:5%;">Mã đơn</th>
                                                        <th rowspan="2" style="width:5%;">Nội dung</th>
                                                        <th rowspan="2" style="width:4%;">Trạng thái</th>
                                                        <th rowspan="1" colspan="3">Người tạo</th>
                                                        <th rowspan="1" colspan="3">Quản lý</th>
                                                        <th rowspan="1" colspan="3">Thủy</th>
                                                        <th rowspan="1" colspan="3">C Thản</th>
                                                        <th rowspan="1" colspan="3">Quản lý 2</th>
                                                        <th rowspan="2" style="width:5%;">Hoàn thành</th>
                                                    </tr>
                                                    <tr>
                                                        <th colspan="1" style="width:5%;">Tên</th>
                                                        <th colspan="1" style="width:5%;">Ngày tạo</th>
                                                        <th colspan="1" style="width:5%;">Ghi chú</th>
                                                        <th colspan="1" style="width:4%;">Tên</th>
                                                        <th colspan="1" style="width:5%;">Ngày kí</th>
                                                        <th colspan="1" style="width:5%;">Ghi chú</th>
                                                        <th colspan="1" style="width:5%;">Tên</th>
                                                        <th colspan="1" style="width:5%;">Ngày kí</th>
                                                        <th colspan="1" style="width:5%;">Ghi chú</th>
                                                        <th colspan="1" style="width:5%;">Tên</th>
                                                        <th colspan="1" style="width:5%;">Ngày kí</th>
                                                        <th colspan="1" style="width:5%;">Ghi chú</th>
                                                        <th colspan="1" style="width:5%;">Tên</th>
                                                        <th colspan="1" style="width:5%;">Ngày kí</th>
                                                        <th colspan="1" style="width:5%;">Ghi chú</th>
                                                        <th colspan="1" style="width:4%;">#</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tbd_View"></tbody>
                                            </table>
                                            <section class="load_section" style="height: 60vh;width: 100%;">
                                                <div class="loader">
                                                    <span class="span_loader" style="--i:1;"></span>
                                                    <span class="span_loader" style="--i:2;"></span>
                                                    <span class="span_loader" style="--i:3;"></span>
                                                    <span class="span_loader" style="--i:4;"></span>
                                                    <span class="span_loader" style="--i:5;"></span>
                                                    <span class="span_loader" style="--i:6;"></span>
                                                    <span class="span_loader" style="--i:7;"></span>
                                                    <span class="span_loader" style="--i:8;"></span>
                                                    <span class="span_loader" style="--i:9;"></span>
                                                    <span class="span_loader" style="--i:10;"></span>
                                                    <span class="span_loader" style="--i:11;"></span>
                                                    <span class="span_loader" style="--i:12;"></span>
                                                    <span class="span_loader" style="--i:13;"></span>
                                                    <span class="span_loader" style="--i:14;"></span>
                                                    <span class="span_loader" style="--i:15;"></span>
                                                    <span class="span_loader" style="--i:16;"></span>
                                                    <span class="span_loader" style="--i:17;"></span>
                                                    <span class="span_loader" style="--i:18;"></span>
                                                    <span class="span_loader" style="--i:19;"></span>
                                                    <span class="span_loader" style="--i:20;"></span>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="ModalDeviceBackRoom">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Chi tiết</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <!-- Modal body -->
            <div class="modal-body">
                <input hidden id="receive_id" />
                <div style="max-height:52vh;overflow:auto;">
                    <table id="table_View_Back" class="table table-bordered">
                        <thead style="background:wheat;font-size:1.5vh;">
                            <tr>
                                <th style="width:4%;">STT</th>
                                <th style="width:12%;">Mã SN</th>
                                <th style="width:10%;">Mã kiểm kê</th>
                                <th style="width:12%;">Tên TB</th>
                                <th style="width:12%;">Model</th>
                                <th style="width:10%;">Mã hiệu chuẩn</th>
                                <th style="width:5%;">Kho</th>
                                <th style="width:5%;">TT</th>
                                <th style="width:10%;">Ghi chú</th>
                                <th style="width:8%;">Ảnh</th>
                                <th style="width:8%;">Quản lý</th>
                                <th style="width:4%;">#</th>
                            </tr>
                        </thead>
                        <tbody id="tbody_View" style="font-size:1.3vh;"></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btnclose">Đóng</button>
            </div>

        </div>
    </div>
</div>
<!-- The Modal -->
<div class="modal" id="ModalEditDeviceBackRoom">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Sửa</h4>
                @*<button type="button" class="close close_edit" data-dismiss="modal">&times;</button>*@
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <input hidden id="device_id_back" />
                <input hidden id="receive_id_back" />
                <table class="table1" style="border:0;margin-left: 60px;font-size:1.5vh;" id="tblBack">
                    <tr>
                        <td style="width: 150px;height: 50px;">Mã SN: </td>
                        <td>
                            <input type="text" class="form-control TYPEDEVICE" style="background-color:white;color:black;border: 1px solid #5c7096;border-radius: 21px;width:10vw;font-size: 1.5vh;" id="maSN">
                        </td>
                        <td style="width: 150px;height: 50px;">Mã Kiểm kê: </td>
                        <td>
                            <input type="text" class="form-control TYPEDEVICE" style="background-color:white;color:black;border: 1px solid #5c7096;border-radius: 21px; width:10vw;font-size: 1.5vh;" id="makiemke">
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;">Tên TB: </td>
                        <td>
                            <input type="text" class="form-control TYPEDEVICE" style="background-color:white;color:black;border: 1px solid #5c7096;border-radius: 21px;width:10vw;font-size: 1.5vh;" id="tenTB">
                        </td>
                        <td style="width: 150px;height: 50px;">Model: </td>
                        <td>
                            <input type="text" class="form-control TYPEDEVICE" style="background-color:white;color:black;border: 1px solid #5c7096;border-radius: 21px; width:10vw;font-size: 1.5vh;" id="model_TB">
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;">Mã Hiệu chuẩn: </td>
                        <td>
                            <input type="text" class="form-control TYPEDEVICE" style="background-color:white;color:black;border: 1px solid #5c7096;border-radius: 21px; width:10vw;font-size: 1.5vh;" id="mahieuchuan">
                        </td>
                        <td style="width: 150px;height: 50px;">Nhập vào kho : </td>
                        <td>
                            <select id="kho_TB" class="form-control TYPEDEVICE" style="background-color:white;color:black;border: 1px solid #5c7096;border-radius: 21px;font-size: 1.5vh;">
                                <option value="0">Chọn kho</option>
                                <option value="1">Auto</option>
                                <option value="2">Arlo</option>
                                <option value="3">NetGear</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 150px;height: 50px;">Tình trạng TB: </td>
                        <td>
                            <select id="statusTB" class="form-control TYPEDEVICE" style="background-color:white;color:black;border: 1px solid #5c7096;border-radius: 21px;width:10vw;font-size: 1.5vh;">
                                <option value="0">Tình trạng TB</option>
                                <option value="1">OK</option>
                                <option value="2">NG</option>
                            </select>
                        </td>
                        <td style="width: 150px;height: 50px;">Ghi chú: </td>
                        <td><textarea type="text" class="form-control TYPEDEVICE" style="background-color:white;color:black;border: 1px solid #5c7096;border-radius: 21px;font-size: 1.5vh;" id="noteTB"></textarea></td>
                    </tr>
                    <tr></tr>
                    <tr class="image_TB">
                        <td style="width: 150px;height: 50px;">Hình ảnh nếu có: </td>
                        <td>
                            <input type="file" class="form-control TYPEDEVICE" style="background-color:white;color:black;border: 1px solid #5c7096;border-radius: 21px;width:10vw;font-size: 1.5vh;" id="imageTB" multiple>
                        </td>
                        <td style="width: 150px;height: 50px;">Quản lý ký</td>
                        <td>
                            <select id="quanly" class="form-control TYPEDEVICE" style="background-color: #ffffff;border: 1px solid #5c7096;border-radius: 27px;color: #333;font-size: 1.5vh;">
                                <option value="0">Chọn quản lý</option>
                                <option value="1008">Attila</option>
                                <option value="1007">Tommy</option>
                                <option value="1022">BINJUN</option>
                            </select>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close_edit">Đóng</button>
                <button type="button" class="btn btn-secondary" onclick="UpdateDeviceBack()" style="background:green;color:white">Hoàn tất</button>
            </div>
        </div>
    </div>
</div>
<script src="/Assets/admin/js/vendor/jquery-1.12.4.min.js"></script>
<script>
    var modal_EditReceive = document.getElementById("myModal_Receive");
    var modalDeviceBackRoom = document.getElementById("ModalDeviceBackRoom");
    var modalEditBack = document.getElementById("ModalEditDeviceBackRoom");
    $(document).on("click", ".close", function () {

        modalDeviceBackRoom.style.display = "none";
    })
    $(document).on("click", ".close_edit", function () {
        modalEditBack.style.display = "none";
    })
    $(document).on("click", ".btnclose", function () {
        modalDeviceBackRoom.style.display = "none";

    })

    $(".load_section").show();
    $("#select_status").change(function () {
        $(".load_section").show();
        $("#tbd_View").hide();
        var st = $("#select_status").val();
        //alert(st);
        loadData(st)
    })
    function loadData(st) {
        $.ajax({
            type: "POST",
            url: "/Receive/get_ReceiveBackDevice?status=" + st,
            //data:data,
            contentType: "application/json",
            datatype: "json/text",
            success: function (data) {
                var row = "";
                var row1 = "";
                if (JSON.parse(data).length > 0) {
                    for (i = 0; i < JSON.parse(data).length; i++) {
                        var status = "";
                        var button = "";
                        if (JSON.parse(data)[i].status == 1) {
                            status = '<a style="color:orange;">Wait_Manager<a>';
                        } else if (JSON.parse(data)[i].status == 2) {
                            status = '<a style="color:#00adff;">Wait_CThan<a>';
                        } else if (JSON.parse(data)[i].status == 7) {
                            status = '<a style="color:orange;">Thuy_Check<a>';
                        } else if (JSON.parse(data)[i].status == 6) {
                            status = '<a style="color:#00ffa1;">Wait_Transfer<a>';
                        } else if (JSON.parse(data)[i].status == 3) {
                            status = '<a style="color:red;">Reject<a>';
                        } else if (JSON.parse(data)[i].status == 4) {
                            status = '<a style="color:green;">OK<a>';
                        } else if (JSON.parse(data)[i].status == 5) {
                            status = '<a style="color:yellow;">Wait_Back<a>';
                        }
                        if (JSON.parse(data)[i].status == 1 || JSON.parse(data)[i].status == 2 || JSON.parse(data)[i].status == 3 || JSON.parse(data)[i].status == 6 || JSON.parse(data)[i].status == 7 || JSON.parse(data)[i].status == 5) {
                            button = '<a style="color:red;" class="fa fa-trash" onclick="DeleteReceive(' + JSON.parse(data)[i].id + ')"><a>';
                        } else {
                            button = "";
                        }
                        row += '<tr style="" >' +
                            '<td>' + (i + 1) + '</td>' +
                            '<td><a onclick="detail(' + "'" + JSON.parse(data)[i].id + "','" + JSON.parse(data)[i].status + "'" + ')">' + JSON.parse(data)[i].code_receive + '</a></td>' +
                            '<td>' + JSON.parse(data)[i].receive_name + '</td>' +
                            '<td>' + status + '</td>' +
                            '<td>' + JSON.parse(data)[i].create_by + '</td>' +
                            '<td>' + (JSON.parse(data)[i].create_date != null ? convert_date(JSON.parse(data)[i].create_date) : "") + '</td>' +
                            '<td style="width: 5%;">' + (JSON.parse(data)[i].note != null ? JSON.parse(data)[i].note : "") + '</td>' +
                            '<td style="width: 5%;">' + JSON.parse(data)[i].manager_confirm + '</td>' +
                            '<td>' + (JSON.parse(data)[i].time_manager_cf_Back != null ? convert_date(JSON.parse(data)[i].time_manager_cf_Back) : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].note_manager != null ? JSON.parse(data)[i].note_manager : "") + '</td>' +
                            '<td style="width: 5%;">Thuy</td>' +
                            '<td>' + (JSON.parse(data)[i].time_Thuy_cf != null ? convert_date(JSON.parse(data)[i].time_Thuy_cf) : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].note_Thuy != null ? JSON.parse(data)[i].note_Thuy : "") + '</td>' +
                            '<td style="width: 5%;">C.Than</td>' +
                            '<td>' + (JSON.parse(data)[i].time_CThanConfirm != null ? convert_date(JSON.parse(data)[i].time_CThanConfirm) : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].note_cThan != null ? JSON.parse(data)[i].note_cThan : "") + '</td>' +
                            '<td style="width:5%;">' + (JSON.parse(data)[i].add_manager_name != null ? JSON.parse(data)[i].add_manager_name : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].time_transfer_cf != null ? convert_date(JSON.parse(data)[i].time_transfer_cf) : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].note_manager_back != null ? JSON.parse(data)[i].note_manager_back : "") + '</td>' +
                            '<td>' + (JSON.parse(data)[i].complete_date != null ? convert_date(JSON.parse(data)[i].complete_date) : "") + '</td>' +
                            '<td>' + button + '</td>' +
                            +'</tr>';
                    }
                } else {
                    row = '<tr>' +
                        '<td colspan="20" style="text-align:center;color:white;">-----No Data-----</td>' +
                        '</tr>';
                }
                $("#tbd_View").empty();
                $("#tbd_View").append(row);
                $(".load_section").hide();
                $("#tbd_View").show();
                //show_table("tbdReceive");
                //$("#tbdReceive1").append(row1);
            },
            error: function (returnval) {
            }
        });
    }
    loadData(100);
    function loadTableBack(receive_id) {
        $.ajax({
            type: "Post",
            url: "/Device/getDataBackDevice?receive_id=" + receive_id,
            async: false,
            contentType: false,
            processData: false,
            success: function (data) {
                var length_array = JSON.parse(data).length;
                var row = "";
                if (length_array > 0) {
                    for (i = 0; i < length_array; i++) {
                        var image = "";
                        if (JSON.parse(data)[i].deviceBack.imageTB != null) {
                            image = "N/A";
                        } else {
                            var image_ = JSON.parse(JSON.parse(data)[i].deviceBack.image_TB);
                            var list_image = "";
                            for (j = 0; j < image_.length; j++) {
                                list_image += '<a href="/Data/Image/' + image_[j].file + '" data-toggle="lightbox" data-max-width="600" >' +
                                    '   <img style="width:150px;height:100px;border: 1px solid #2c303a" src="/Data/Image/' + image_[j].file + '" class="img-fluid">' +
                                    '</a>';
                            }
                            image = list_image;
                        }
                        var edit = "'" + JSON.parse(data)[i].deviceBack.id + "','" + JSON.parse(data)[i].deviceBack.produce_SN + "','" + JSON.parse(data)[i].deviceBack.device_name + "','" + JSON.parse(data)[i].deviceBack.calibration + "','" + JSON.parse(data)[i].deviceBack.status + "','" + JSON.parse(data)[i].deviceBack.makiemke + "','" + JSON.parse(data)[i].deviceBack.parameter + "','" + JSON.parse(data)[i].deviceBack.location + "','" + JSON.parse(data)[i].deviceBack.note_status + "','" + JSON.parse(data)[i].deviceBack.manager_id + "','" + JSON.parse(data)[i].deviceBack.receive_id + "'";
                        var button = '<a style="color:green;" onclick="EditDeviceBack(' + edit + ')" class="fa fa-edit"></a><a style="color:red;" onclick="DeleteDeviceBack(' + "'" + JSON.parse(data)[i].deviceBack.id + "','" + JSON.parse(data)[i].deviceBack.receive_id + "'" + ')" class="fa fa-trash"></a>';
                        row = row + '<tr>' +
                                    '<td><span>' + (i + 1) + '</span></td></td>' +
                                    '<td>' + JSON.parse(data)[i].deviceBack.produce_SN + '</td>' +
                                    '<td>' + JSON.parse(data)[i].deviceBack.makiemke + '</td>' +
                                    '<td>' + JSON.parse(data)[i].deviceBack.device_name + '</td>' +
                                    '<td>' + JSON.parse(data)[i].deviceBack.parameter + '</td>' +
                                    '<td>' + JSON.parse(data)[i].deviceBack.calibration + '</td>' +
                                    '<td>' + JSON.parse(data)[i].deviceBack.location + '</td>' +
                                    '<td>' + (JSON.parse(data)[i].deviceBack.status == 1 ? "OK" : "NG") + '</td>' +
                                    '<td>' + JSON.parse(data)[i].deviceBack.note_status + '</td>' +
                                    '<td>' + image + '</td>' +
                                    '<td>' + JSON.parse(data)[i].username + '</td>' +
                                    '<td>' + button + '</td>' +
                                    '</tr>';
                    }
                } else {
                    row = '<tr><td colspan="11" style="text-align:center;">--------No Data-------</td></tr>';
                }
                $("#tbody_View").empty();
                $("#tbody_View").append(row);
            },
            error: function (err) {
                //debugger
                alert("FAIL!");
            }
        });
    }
    function EditDeviceBack(id, produce_SN, device_name, calibration, status, makiemke, parameter, location, note_status, manager_id, receive_id) {
        $("#receive_id_back").val("");
        $("#device_id_back").val("");
        $("#maSN").val("");
        $("#makiemke").val("");
        $("#tenTB").val("");
        $("#model_TB").val("");
        $("#mahieuchuan").val("");
        $("#noteTB").val("");
        $("#device_id_back").val(id);
        $("#maSN").val(produce_SN);
        $("#makiemke").val(makiemke);
        $("#tenTB").val(device_name);
        $("#model_TB").val(parameter);
        $("#statusTB").val(status);
        $("#quanly").val(manager_id);
        $("#receive_id_back").val(receive_id);

        if (location == "Auto") {
            $("#kho_TB").val(1);
        } else if (location == "Arlo") {
            $("#kho_TB").val(2);
        } else if (location == "Netgear") {
            $("#kho_TB").val(3);
        }
        $("#kho_TB").val((location == "Auto" ? 1 : location == "Netgear" ? 2 : 3));
        $("#mahieuchuan").val(calibration);
        $("#noteTB").val(note_status);
        modalEditBack.style.display = "block";
    }
    function UpdateDeviceBack() {
        var back_id = $("#device_id_back").val();
        var receive_id = $("#receive_id_back").val();
        var makiemke;
        if ($("#makiemke").val() != "") {
            makiemke = document.getElementById("makiemke").value;
        } else {
            alert("Vui lòng nhập mã kiểm  kê!");
            //$("#makiemke").css({ "border-color": "red" });
            return;
        }
        var maSN;
        maSN = document.getElementById("maSN").value;

        var tenTB;
        if ($("#tenTB").val() != "") {
            tenTB = document.getElementById("tenTB").value;
        } else {
            alert("Vui lòng nhập tên TB!");
            return;
        }
        var mahieuchuan;
        if ($("#mahieuchuan").val() != "") {
            mahieuchuan = document.getElementById("mahieuchuan").value;
        } else {
            mahieuchuan = "";
        }
        var model_TB;
        if ($("#model_TB").val() != "") {
            model_TB = document.getElementById("model_TB").value;
        } else {
            alert("Vui lòng nhập Model TB!");
            //$("#model_TB").css({ "border-color": "red" });
            return;
        }
        var statusTB;

        var kho_TB;
        if ($("#kho_TB").val() != 0) {
            kho_TB = $("#kho_TB option:selected").text();
        } else {
            alert("Vui lòng chọn Kho!");
            return;
        }

        if ($("#statusTB").val() != 0) {
            statusTB = $("#statusTB").val();

        } else {
            alert("Vui lòng chọn Tình trạng TB!");
            return;
        }
        var imageTB;
        if ($("#imageTB").get(0).files.length != 0) {
            imageTB = $("#imageTB").get(0).files;
        } else {
            alert("Vui lòng chọn hình ảnh Thiết bị!");
            return;
        }

        var noteTB;
        if ($("#noteTB").val() != "") {
            noteTB = document.getElementById("noteTB").value;
        } else {
            noteTB = "";
        }
        var quanly;
        var quanly_id;
        if ($("#quanly").val() != 0) {
            quanly_id = $("#quanly").val();
            quanly = $("#quanly option:selected").text();
        } else {
            alert("Vui lòng chọn Quản lý!");
            return;
        }
        var data1 = new FormData;
        data1.append("back_id", back_id);
        data1.append("makiemke", makiemke);
        data1.append("maSN", maSN);
        data1.append("tenTB", tenTB);
        data1.append("model_TB", model_TB);
        data1.append("kho_TB", kho_TB);
        data1.append("statusTB", statusTB);
        if (imageTB != "") {
            for (var i = 0; i < imageTB.length; i++) {
                data1.append(`imageTB[${i}]`, imageTB[i]);
            }
        } else {
            data1.append("imageTB", imageTB);
        }
        data1.append("noteTB", noteTB);
        data1.append("quanly", quanly);
        data1.append("quanly_id", quanly_id);
        data1.append("calibration", mahieuchuan);
        data1.append("receive_id", receive_id);
        debugger
        $.ajax({
            type: "Post",
            url: "/Device/Update_DeviceBack",
            data: data1,
            async: false,
            contentType: false,
            processData: false,
            success: function (data) {
                debugger
                if (data != "NG") {
                    alert("Thành công!");
                    loadTableBack(parseInt(data))
                    modalEditBack.style.display = "none";
                    //location.reload();
                } else {
                    alert("Tạo đơn k thành công!");
                }
            },
            error: function (err) {
                //debugger
                alert("FAIL!");
            }
        });
    }
    function detail(receive_id, status) {
        if (parseInt(status) == 4) {
            $.ajax({
                type: "Post",
                url: "/Receive/get_Device_Back?receive_id=" + receive_id,
                async: false,
                contentType: false,
                processData: false,
                success: function (data) {
                    var length_array = JSON.parse(data).length;
                    var row = "";
                    if (length_array > 0) {
                        for (i = 0; i < length_array; i++) {
                            var image = "";
                            if (JSON.parse(data)[i].device.imageTB != null) {
                                image = "N/A";
                            } else {
                                var image_ = JSON.parse(JSON.parse(data)[i].device.image_TB);
                                var list_image = "";
                                for (j = 0; j < image_.length; j++) {
                                    list_image += '<a href="/Data/Image/' + image_[j].file + '" data-toggle="lightbox" data-max-width="600" >' +
                                        '   <img style="width:150px;height:100px;border: 1px solid #2c303a" src="/Data/Image/' + image_[j].file + '" class="img-fluid">' +
                                        '</a>';
                                }
                                image = list_image;
                            }
                            row = row + '<tr>' +
                                        '<td><span>' + (i + 1) + '</span></td></td>' +
                                        '<td>' + JSON.parse(data)[i].device.produce_SN + '</td>' +
                                        '<td>' + JSON.parse(data)[i].device.makiemke + '</td>' +
                                        '<td>' + JSON.parse(data)[i].device.device_name + '</td>' +
                                        '<td>' + JSON.parse(data)[i].device.parameter + '</td>' +
                                        '<td>' + JSON.parse(data)[i].device.calibration + '</td>' +
                                        '<td>' + JSON.parse(data)[i].device.location + '</td>' +
                                        '<td>' + (JSON.parse(data)[i].device.status == 1 ? "OK" : "NG") + '</td>' +
                                        '<td>' + JSON.parse(data)[i].device.note_status + '</td>' +
                                        '<td>' + image + '</td>' +
                                        '<td>' + JSON.parse(data)[i].manager_name + '</td>' +
                                        '<td></td>' +
                                        '</tr>';
                        }
                    } else {
                        row = '<tr><td colspan="11" style="text-align:center;">--------No Data-------</td></tr>';
                    }
                    $("#tbody_View").empty();
                    $("#tbody_View").append(row);

                },
                error: function (err) {
                    //debugger
                    alert("FAIL!");
                }
            });
        } else {
            loadTableBack(receive_id);
        }
        modalDeviceBackRoom.style.display = "block";
    }

    function ReUpload() {
        var receive_id = document.getElementById("receive_id").value;
        $.ajax({
            type: "Post",
            url: "/Receive/ReUpload?id=" + receive_id,
            async: false,
            cache: false,
            timeout: 30000,
            contentType: false,
            processData: false,
            success: function (data) {
                if (data == "OK") {
                    alert("OK Pro :) !");
                    location.reload();
                } else {
                    alert("Toang :)");
                }

            },
            error: function (err) {
                debugger
                alert("FAIL!");
            }
        });
    }

    function EditReceive(id, receive_name, note) {
        $("#id_receive").val(id);
        $("#receiveName").val(receive_name);
        $("#note").val(note);
        modal_EditReceive.style.display = "block";
    }
    function UpdateReceive() {
        var id = document.getElementById("id_receive").value;
        var receive_name = "";
        if ($("#receiveName").val() != 0) {
            receive_name = document.getElementById("receiveName").value;
        } else {
            alert("Pls Fill Receive Name!");
            return;
        }
        var note = "";
        if ($("#note").val() != 0) {
            note = document.getElementById("note").value;
        } else {
            note = "";
        }
        var data = new FormData;
        data.append("id", id);
        data.append("receive_name", receive_name);
        data.append("note", note);

        $.ajax({
            type: "Post",
            url: "/Receive/Create_Receive",
            data: data,
            async: false,
            contentType: false,
            processData: false,
            success: function (data) {
                debugger
                //get_Device_Receive(int.parse(data));
                alert("OK");

                modal_EditReceive.style.display = "none";
                location.reload();
            },
            error: function (err) {
                //debugger
                alert("FAIL!");
            }
        });
    }
    function DeleteReceive(id) {
        if (confirm("Do you want to delete this row?")) {
            //alert(id_delete);
            $.ajax({
                type: "POST",
                url: "/Receive/Delete",
                data: '{id: ' + id + '}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {

                    alert("SUCCESS!");
                    location.reload();
                }
            });
        }
    }
    function EditDevice(quantity, unit, device_id, receive_id, id, type, note) {
        $("#id_clip").val(id);
        $("#device_name").val(device_id);
        $("#id_receive").val(receive_id);
        $(".type_device").val(unit);
        $(".quantity").val(quantity);
        if (type == 1) {
            $("#check_1").prop("checked");
        } else if (type == 2) {
            $("#check_2").prop("checked");
        } else if (type == 3) {
            $("#check_3").prop("checked");
        }
        $(".note").val(note);
        modalEditDevice.style.display = "block";
    }
    function DeleteDeviceBack(id, receive_id) {
        if (confirm("Do you want to delete this row?")) {
            //alert(id_delete);
            $.ajax({
                type: "POST",
                url: "/Device/DeleteDeviceBack",
                data: '{id: ' + id + '}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {

                    alert("Đã xóa!");
                    loadTableBack(receive_id);
                }
            });
        }
    }
    //Check Quantity Of Device
    function check_Quantity(device_id, quantity) {
        $.ajax({
            type: "Post",
            url: "/Device/check_Quantity?device_id=" + device_id + "&quantity=" + quantity,
            async: false,
            contentType: false,
            processData: false,
            success: function (data) {
                debugger
                return data;
            },
            error: function (err) {
                debugger
                alert("FAIL!");
            }
        });
    }
    function convert_date(date) {
        var completedDate = new Date(parseInt(date.replace("/Date(", "").replace(")/")));
        var dd = completedDate.getDate();
        var mm = completedDate.getMonth() + 1; //January is 0!
        var yyyy = completedDate.getFullYear();
        if (dd < 10) { dd = '0' + dd }
        if (mm < 10) { mm = '0' + mm }
        return dd + '-' + mm + '-' + yyyy;
    }
    $("#input_search").on("keyup", function () {
        //get the input value, trimmed, and lowercased
        var value = this.value.trim().toLowerCase();
        //get the associated table
        var $table;
        $table = $("#tbd_View");
        //show all the rows to "undo" previous filtering
        $table.find('tr').show();

        //only filter if the value is not blank
        if (value) {
            $table.find('thead tr').show();
            //find all the rows that do not match the filter, and hide them
            $table.find('tr').filter(function () {
                return this.innerText.toLowerCase().indexOf(value) < 0;
            }).hide();
        }
    });
</script>
